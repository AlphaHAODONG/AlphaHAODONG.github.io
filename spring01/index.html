

<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>Spring01 - AlphaGuo Blog</title><meta name="Description" content="关山难越"><meta property="og:title" content="Spring01" />
<meta property="og:description" content="一、Spring简介 1.1 目前我们代码存在的问题 代码书写现状 耦合度偏高 解决方案 使用对象时，在程序中不要主动使用new产生对象，转换为由外部提供对" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ghd.icu/spring01/" /><meta property="og:image" content="https://ghd.icu/images/favicon-16x16.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-31T20:33:49+08:00" />
<meta property="article:modified_time" content="2023-12-31T20:33:49+08:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://ghd.icu/images/favicon-16x16.png" /><meta name="twitter:title" content="Spring01"/>
<meta name="twitter:description" content="一、Spring简介 1.1 目前我们代码存在的问题 代码书写现状 耦合度偏高 解决方案 使用对象时，在程序中不要主动使用new产生对象，转换为由外部提供对"/>
<meta name="twitter:site" content="@guo_alpha36266"/>
<meta name="application-name" content="AlphaGuo">
<meta name="apple-mobile-web-app-title" content="AlphaGuo">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><meta name="twitter:creator" content="@@guo_alpha36266" /><link rel="icon" href="/images/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://ghd.icu/spring01/" /><link rel="prev" href="https://ghd.icu/mybatis%E7%9A%84%E5%A4%9A%E8%A1%A8%E6%A8%A1%E5%9E%8B/" /><link rel="next" href="https://ghd.icu/%E6%8C%87%E9%92%88/" />
<link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/color.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Spring01",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://ghd.icu/spring01/"
        },"genre": "posts","keywords": "Spring","wordcount":  20111 ,
        "url": "https://ghd.icu/spring01/","datePublished": "2023-12-31T20:33:49+08:00","dateModified": "2023-12-31T20:33:49+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"authors": [{
                        "@type": "Person",
                        "name": "AlphaGuo"                    
                    }],"description": ""
    }
    </script></head>

<body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark'); window.theme = theme;   window.isDark = window.theme !== 'light' }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('auto' === 'light' || 'auto' === 'dark' || 'auto' === 'black') setTheme('auto'), saveTheme('auto'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="AlphaGuo Blog"><span id="desktop-header-typeit" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-select" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                    <select class="color-theme-select" id="theme-select-desktop" title="切换主题">
                        <option value="light">浅色</option>
                        <option value="dark">深色</option>
                        <option value="black">黑色</option>
                        <option value="auto">跟随系统</option>
                    </select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="AlphaGuo Blog"><span id="mobile-header-typeit" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a href="javascript:void(0);" class="menu-item theme-select" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
                <select class="color-theme-select" id="theme-select-mobile" title="切换主题">
                    <option value="light">浅色</option>
                    <option value="dark">深色</option>
                    <option value="black">黑色</option>
                    <option value="auto">跟随系统</option>
                </select>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">目录</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#一spring简介">一、Spring简介</a>
      <ul>
        <li>
          <ul>
            <li><a href="#11-目前我们代码存在的问题">1.1 目前我们代码存在的问题</a></li>
            <li><a href="#12-核心概念">1.2 核心概念</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#二ioc和di入门案例重点">二、IOC和DI入门案例【重点】</a>
      <ul>
        <li><a href="#1-ioc入门案例重点">1 IOC入门案例【重点】</a>
          <ul>
            <li><a href="#问题导入">问题导入</a></li>
            <li><a href="#11-门案例思路分析">1.1 门案例思路分析</a></li>
            <li><a href="#12-实现步骤">1.2 实现步骤</a></li>
            <li><a href="#13-实现代码">1.3 实现代码</a></li>
            <li><a href="#14-运行结果">1.4 运行结果</a></li>
          </ul>
        </li>
        <li><a href="#2-di入门案例重点">2 DI入门案例【重点】</a>
          <ul>
            <li><a href="#问题导入-1">问题导入</a></li>
            <li><a href="#21-di入门案例思路分析">2.1 DI入门案例思路分析</a></li>
            <li><a href="#22-实现步骤">2.2 实现步骤</a></li>
            <li><a href="#23-实现代码">2.3 实现代码</a></li>
            <li><a href="#24-图解演示">2.4 图解演示</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#三bean的基础配置">三、Bean的基础配置</a>
      <ul>
        <li><a href="#问题导入-2">问题导入</a></li>
        <li><a href="#1-bean基础配置重点">1 Bean基础配置【重点】</a>
          <ul>
            <li><a href="#配置说明">配置说明</a></li>
            <li><a href="#代码演示">代码演示</a></li>
            <li><a href="#运行结果">运行结果</a></li>
          </ul>
        </li>
        <li><a href="#2-bean别名配置">2 Bean别名配置</a>
          <ul>
            <li><a href="#配置说明-1">配置说明</a></li>
            <li><a href="#代码演示-1">代码演示</a></li>
            <li><a href="#打印结果">打印结果</a></li>
          </ul>
        </li>
        <li><a href="#3-bean作用范围配置重点">3 Bean作用范围配置【重点】</a>
          <ul>
            <li><a href="#配置说明-2">配置说明</a></li>
            <li><a href="#代码演示-2">代码演示</a></li>
            <li><a href="#打印结果-1">打印结果</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#四bean的实例化">四、Bean的实例化</a>
      <ul>
        <li><a href="#问题导入-3">问题导入</a></li>
        <li><a href="#1-bean是如何创建的理解">1 Bean是如何创建的【理解】</a></li>
        <li><a href="#2-实例化bean的三种方式">2 实例化Bean的三种方式</a>
          <ul>
            <li><a href="#21-构造方法方式重点">2.1 构造方法方式【重点】</a></li>
            <li><a href="#22-静态工厂方式">2.2 静态工厂方式</a></li>
            <li><a href="#23-实例工厂方式">2.3 实例工厂方式</a></li>
            <li><a href="#24-实现factorybeant方式扩展了解">2.4 实现FactoryBean&lt;T&gt;方式【扩展,了解】</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#五bean的生命周期了解">五、Bean的生命周期【了解】</a>
      <ul>
        <li><a href="#问题导入-4">问题导入</a></li>
        <li><a href="#1-生命周期相关概念介绍">1 生命周期相关概念介绍</a></li>
        <li><a href="#2-代码演示">2 代码演示</a>
          <ul>
            <li><a href="#21-bean生命周期控制">2.1 Bean生命周期控制</a></li>
            <li><a href="#22-bean生命周期控制">2.2 Bean生命周期控制</a></li>
          </ul>
        </li>
        <li><a href="#3-bean销毁时机">3 Bean销毁时机</a></li>
      </ul>
    </li>
    <li><a href="#六依赖注入di配置">六、依赖注入(DI配置)</a>
      <ul>
        <li><a href="#1-依赖注入方式重点">1 依赖注入方式【重点】</a>
          <ul>
            <li><a href="#问题导入-5">问题导入</a></li>
            <li><a href="#11-依赖注入的两种方式">1.1 依赖注入的两种方式</a></li>
            <li><a href="#12-setter方式注入">1.2 setter方式注入</a>
              <ul>
                <li><a href="#问题导入-6">问题导入</a></li>
                <li><a href="#引用类型">引用类型</a></li>
                <li><a href="#简单类型">简单类型</a></li>
              </ul>
            </li>
            <li><a href="#13-构造方式注入">1.3 构造方式注入</a>
              <ul>
                <li><a href="#问题导入-7">问题导入</a></li>
                <li><a href="#引用类型-1">引用类型</a></li>
                <li><a href="#简单类型-1">简单类型</a></li>
                <li><a href="#参数适配了解">参数适配【了解】</a></li>
              </ul>
            </li>
            <li><a href="#14-依赖注入方式选择">1.4 依赖注入方式选择</a></li>
          </ul>
        </li>
        <li><a href="#2-依赖自动装配理解">2 依赖自动装配【理解】</a>
          <ul>
            <li><a href="#问题导入-8">问题导入</a></li>
            <li><a href="#21-自动装配概念">2.1 自动装配概念</a></li>
            <li><a href="#22-自动装配类型">2.2 自动装配类型</a>
              <ul>
                <li><a href="#依赖自动装配">依赖自动装配</a></li>
                <li><a href="#依赖自动装配特征">依赖自动装配特征</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#3-集合注入">3 集合注入</a>
          <ul>
            <li><a href="#31-注入数组类型数据">3.1 注入数组类型数据</a></li>
            <li><a href="#32-注入list类型数据">3.2 注入List类型数据</a></li>
            <li><a href="#33-注入set类型数据">3.3 注入Set类型数据</a></li>
            <li><a href="#34-注入map类型数据">3.4 注入Map类型数据</a></li>
            <li><a href="#35-注入properties类型数据">3.5 注入Properties类型数据</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#四第三方资源配置管理">四、第三方资源配置管理</a>
      <ul>
        <li><a href="#1-管理datasource连接池对象">1 管理DataSource连接池对象</a>
          <ul>
            <li><a href="#问题导入-9">问题导入</a></li>
            <li><a href="#11-管理druid连接池重点">1.1 管理Druid连接池【重点】</a></li>
            <li><a href="#12-管理c3p0连接池">1.2 管理c3p0连接池</a></li>
          </ul>
        </li>
        <li><a href="#2-加载properties属性文件重点">2 加载properties属性文件【重点】</a>
          <ul>
            <li><a href="#问题导入-10">问题导入</a></li>
            <li><a href="#21-基本用法">2.1 基本用法</a></li>
            <li><a href="#22-配置不加载系统属性">2.2 配置不加载系统属性</a></li>
            <li><a href="#23-加载properties文件写法">2.3 加载properties文件写法</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#五spring容器">五、Spring容器</a>
      <ul>
        <li><a href="#1-spring核心容器介绍">1 Spring核心容器介绍</a>
          <ul>
            <li><a href="#问题导入-11">问题导入</a></li>
            <li><a href="#11-创建容器">1.1 创建容器</a></li>
            <li><a href="#12-获取bean对象">1.2 获取bean对象</a></li>
            <li><a href="#13-容器类层次结构">1.3 容器类层次结构</a></li>
            <li><a href="#14-beanfactory">1.4 BeanFactory</a></li>
          </ul>
        </li>
        <li><a href="#2-spring核心容器总结">2 Spring核心容器总结</a>
          <ul>
            <li><a href="#21-容器相关">2.1 容器相关</a></li>
            <li><a href="#22-bean相关">2.2 bean相关</a></li>
            <li><a href="#23-依赖注入相关">2.3 依赖注入相关</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#六spring注解开发">六、Spring注解开发</a>
      <ul>
        <li><a href="#1-注解开发定义bean对象重点">1 注解开发定义Bean对象【重点】</a>
          <ul>
            <li><a href="#问题导入-12">问题导入</a></li>
            <li><a href="#11-基本使用">1.1 基本使用</a></li>
            <li><a href="#12-component三个衍生注解">1.2 @Component三个衍生注解</a></li>
          </ul>
        </li>
        <li><a href="#2-纯注解开发模式重点">2 纯注解开发模式【重点】</a>
          <ul>
            <li><a href="#问题导入-13">问题导入</a></li>
            <li><a href="#21-纯注解开发模式介绍">2.1 纯注解开发模式介绍</a></li>
            <li><a href="#22-代码演示">2.2 代码演示</a></li>
          </ul>
        </li>
        <li><a href="#3-注解开发bean作用范围和生命周期管理">3 注解开发Bean作用范围和生命周期管理</a>
          <ul>
            <li><a href="#问题导入-14">问题导入</a></li>
            <li><a href="#31-bean作用范围注解配置">3.1 bean作用范围注解配置</a></li>
            <li><a href="#32-bean生命周期注解配置">3.2 bean生命周期注解配置</a></li>
          </ul>
        </li>
        <li><a href="#4-注解开发依赖注入重点">4 注解开发依赖注入【重点】</a>
          <ul>
            <li><a href="#问题导入-15">问题导入</a></li>
            <li><a href="#41-使用autowired注解开启自动装配模式按类型">4.1 使用@Autowired注解开启自动装配模式（按类型）</a></li>
            <li><a href="#42-使用qualifier注解指定要装配的bean名称">4.2 使用@Qualifier注解指定要装配的bean名称</a></li>
            <li><a href="#43-使用value实现简单类型注入">4.3 使用@Value实现简单类型注入</a></li>
          </ul>
        </li>
        <li><a href="#5-注解开发管理第三方bean重点">5 注解开发管理第三方Bean【重点】</a>
          <ul>
            <li><a href="#问题导入-16">问题导入</a></li>
            <li><a href="#第一步单独定义配置类"><strong>【第一步】单独定义配置类</strong></a></li>
            <li><a href="#第二步将独立的配置类加入核心配置"><strong>【第二步】将独立的配置类加入核心配置</strong></a>
              <ul>
                <li><a href="#方式1import注解导入式">方式1：@Import注解导入式</a></li>
                <li><a href="#方式2componentscan扫描式">方式2：@ComponentScan扫描式</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#6-注解开发为第三方bean注入资源重点">6 注解开发为第三方Bean注入资源【重点】</a>
          <ul>
            <li><a href="#问题导入-17">问题导入</a></li>
            <li><a href="#61-简单类型依赖注入">6.1 简单类型依赖注入</a></li>
            <li><a href="#62-引用类型依赖注入">6.2 引用类型依赖注入</a></li>
          </ul>
        </li>
        <li><a href="#7-注解开发总结">7 注解开发总结</a></li>
      </ul>
    </li>
    <li><a href="#七spring整合其他技术重点">七、Spring整合其他技术【重点】</a>
      <ul>
        <li><a href="#1-spring整合mybatis重点">1 Spring整合mybatis【重点】</a>
          <ul>
            <li><a href="#11-思路分析">1.1 思路分析</a>
              <ul>
                <li><a href="#问题导入-18">问题导入</a></li>
                <li><a href="#111-mybatis程序核心对象分析">1.1.1 MyBatis程序核心对象分析</a></li>
                <li><a href="#112-整合mybatis">1.1.2 整合MyBatis</a></li>
              </ul>
            </li>
            <li><a href="#12-代码实现">1.2 代码实现</a>
              <ul>
                <li><a href="#问题导入-19">问题导入</a></li>
                <li><a href="#前置工作">【前置工作】</a></li>
                <li><a href="#第一步导入spring整合mybatis依赖java17"><strong>【第一步】导入Spring整合Mybatis依赖</strong>(JAVA17)</a></li>
                <li><a href="#第二步创建jdbcconfig配置datasource数据源"><strong>【第二步】创建JdbcConfig配置DataSource数据源</strong></a></li>
                <li><a href="#第三步创建mybatisconfig整合mybatis"><strong>【第三步】创建MybatisConfig整合mybatis</strong></a></li>
                <li><a href="#第四步创建springconfig主配置类进行包扫描和加载其他配置类"><strong>【第四步】创建SpringConfig主配置类进行包扫描和加载其他配置类</strong></a></li>
                <li><a href="#第五步定义测试类进行测试"><strong>【第五步】定义测试类进行测试</strong></a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#2-spring整合junit单元测试重点">2 Spring整合Junit单元测试【重点】</a>
          <ul>
            <li><a href="#问题导入-20">问题导入</a></li>
            <li><a href="#第一步导入整合的依赖坐标spring-test">【第一步】导入整合的依赖坐标spring-test</a></li>
            <li><a href="#第二步使用spring整合junit专用的类加载器">【第二步】使用Spring整合Junit专用的类加载器</a></li>
            <li><a href="#第三步加载配置文件或者配置类">【第三步】加载配置文件或者配置类</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#八aop">八、AOP</a>
      <ul>
        <li><a href="#1-aop简介">1 AOP简介</a>
          <ul>
            <li><a href="#问题导入-21">问题导入</a></li>
            <li><a href="#11-aop简介和作用理解">1.1 AOP简介和作用【理解】</a></li>
            <li><a href="#12-aop中的核心概念理解">1.2 AOP中的核心概念【理解】</a></li>
          </ul>
        </li>
        <li><a href="#2-aop入门案例重点">2 AOP入门案例【重点】</a>
          <ul>
            <li><a href="#问题导入-22">问题导入</a></li>
            <li><a href="#21-aop入门案例思路分析">2.1 AOP入门案例思路分析</a></li>
            <li><a href="#22-aop入门案例实现">2.2 AOP入门案例实现</a>
              <ul>
                <li><a href="#第一步导入aop相关坐标">【第一步】导入aop相关坐标</a></li>
                <li><a href="#第二步定义dao接口与实现类">【第二步】定义dao接口与实现类</a></li>
                <li><a href="#第三步定义通知类制作通知方法">【第三步】定义通知类，制作通知方法</a></li>
                <li><a href="#第四步定义切入点表达式配置切面绑定切入点与通知关系">【第四步】定义切入点表达式、配置切面(绑定切入点与通知关系)</a></li>
                <li><a href="#第五步在配置类中进行spring注解包扫描和开启aop功能">【第五步】在配置类中进行Spring注解包扫描和开启AOP功能</a></li>
                <li><a href="#测试类和运行结果">测试类和运行结果</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#3-aop工作流程理解">3 AOP工作流程【理解】</a>
          <ul>
            <li><a href="#问题导入-23">问题导入</a></li>
            <li><a href="#31-aop工作流程">3.1 AOP工作流程</a></li>
            <li><a href="#32-aop核心概念">3.2 AOP核心概念</a></li>
            <li><a href="#33-在测试类中验证代理对象">3.3 在测试类中验证代理对象</a></li>
          </ul>
        </li>
        <li><a href="#4-aop切入点表达式">4 AOP切入点表达式</a>
          <ul>
            <li><a href="#问题导入-24">问题导入</a></li>
            <li><a href="#41-语法格式">4.1 语法格式</a></li>
            <li><a href="#42-通配符">4.2 通配符</a></li>
            <li><a href="#43-书写技巧">4.3 书写技巧</a></li>
          </ul>
        </li>
        <li><a href="#5-aop通知类型重点">5 AOP通知类型【重点】</a>
          <ul>
            <li><a href="#问题导入-25">问题导入</a></li>
            <li><a href="#51-aop通知分类">5.1 AOP通知分类</a></li>
            <li><a href="#52-aop通知详解">5.2 AOP通知详解</a>
              <ul>
                <li><a href="#521-前置通知">5.2.1 前置通知</a></li>
                <li><a href="#522-后置通知">5.2.2 后置通知</a></li>
                <li><a href="#523-返回后通知">5.2.3 返回后通知</a></li>
                <li><a href="#524-抛出异常后通知">5.2.4 抛出异常后通知</a></li>
                <li><a href="#525-环绕通知">5.2.5 环绕通知</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#九aop案例">九、AOP案例</a>
      <ul>
        <li><a href="#1-案例-测量业务层接口万次执行效率">1 案例-测量业务层接口万次执行效率</a>
          <ul>
            <li><a href="#问题导入-26">问题导入</a></li>
            <li><a href="#11-需求和分析">1.1 需求和分析</a></li>
            <li><a href="#12-代码实现-1">1.2 代码实现</a>
              <ul>
                <li><a href="#前置工作环境准备">【前置工作】环境准备</a></li>
                <li><a href="#第一步编写通知类">【第一步】编写通知类</a></li>
                <li><a href="#第二步在springconfig配置类上开启aop注解功能">【第二步】在SpringConfig配置类上开启AOP注解功能</a></li>
                <li><a href="#第三步运行测试类查看结果">【第三步】运行测试类，查看结果</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#2-aop切入点数据获取">2 AOP切入点数据获取</a>
          <ul>
            <li><a href="#问题导入-27">问题导入</a></li>
            <li><a href="#21-获取参数">2.1 获取参数</a></li>
            <li><a href="#22-获取返回值">2.2 获取返回值</a></li>
            <li><a href="#23-获取异常">2.3 获取异常</a></li>
          </ul>
        </li>
        <li><a href="#3-案例-百度网盘密码数据兼容处理">3 案例-百度网盘密码数据兼容处理</a>
          <ul>
            <li><a href="#问题导入-28">问题导入</a></li>
            <li><a href="#31-需求和分析">3.1 需求和分析</a></li>
            <li><a href="#32-代码实现">3.2 代码实现</a>
              <ul>
                <li><a href="#前置工作环境准备-1">【前置工作】环境准备</a></li>
                <li><a href="#第一步编写通知类-1">【第一步】编写通知类</a></li>
                <li><a href="#第二步在springconfig配置类上开启aop注解功能-1">【第二步】在SpringConfig配置类上开启AOP注解功能</a></li>
                <li><a href="#第三步运行测试类查看结果-1">【第三步】运行测试类，查看结果</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#4-aop开发总结">4 AOP开发总结</a>
          <ul>
            <li><a href="#41-aop的核心概念">4.1 AOP的核心概念</a></li>
            <li><a href="#42-切入点表达式语法">4.2 切入点表达式语法</a></li>
            <li><a href="#43-五种通知类型">4.3 五种通知类型</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#十spring事务管理">十、Spring事务管理</a>
      <ul>
        <li><a href="#1-spring事务简介重点">1 Spring事务简介【重点】</a>
          <ul>
            <li><a href="#问题导入-29">问题导入</a></li>
            <li><a href="#11-spring事务作用">1.1 Spring事务作用</a></li>
            <li><a href="#12-需求和分析">1.2 需求和分析</a></li>
            <li><a href="#13-代码实现">1.3 代码实现</a>
              <ul>
                <li><a href="#前置工作环境准备-2">【前置工作】环境准备</a></li>
                <li><a href="#第一步在业务层接口上添加spring事务管理">【第一步】在业务层接口上添加Spring事务管理</a></li>
                <li><a href="#第二步设置事务管理器将事务管理器添加到ioc容器中">【第二步】设置事务管理器(将事务管理器添加到IOC容器中)</a></li>
                <li><a href="#第三步开启注解式事务驱动">【第三步】开启注解式事务驱动</a></li>
                <li><a href="#第四步运行测试类查看结果">【第四步】运行测试类，查看结果</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#2-spring事务角色理解">2 Spring事务角色【理解】</a>
          <ul>
            <li><a href="#问题导入-30">问题导入</a></li>
            <li><a href="#21-spring事务角色">2.1 Spring事务角色</a></li>
          </ul>
        </li>
        <li><a href="#3-spring事务相关配置">3 Spring事务相关配置</a>
          <ul>
            <li><a href="#问题导入-31">问题导入</a></li>
            <li><a href="#31-事务配置">3.1 事务配置</a></li>
            <li><a href="#32-案例转账业务追加日志">3.2 案例：转账业务追加日志</a>
              <ul>
                <li><a href="#需求和分析">需求和分析</a></li>
                <li><a href="#准备工作环境整备">【准备工作】环境整备</a></li>
                <li><a href="#第一步在accountserviceimpl中调用logservice中添加日志的方法">【第一步】在AccountServiceImpl中调用logService中添加日志的方法</a></li>
                <li><a href="#第二步在logservice的log方法上设置事务的传播行为">【第二步】在LogService的log()方法上设置事务的传播行为</a></li>
                <li><a href="#第三步运行测试类查看结果-2">【第三步】运行测试类，查看结果</a></li>
              </ul>
            </li>
            <li><a href="#33-事务传播行为">3.3 事务传播行为</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Spring01</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class='author'><span class="author fas fa-user-circle fa-fw"></span><span class='screen-reader-text'>  </span><a href='https://ghd.icu/authors/alphaguo'>AlphaGuo</a></span>
                </span>&nbsp;<span class="post-category">收录于 </span>&nbsp;<span class="post-category">类别 <a href="/categories/spring/"><i class="far fa-folder fa-fw"></i>Spring</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2023-12-31">2023-12-31</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="2023-12-31">2023-12-31</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 20111 字&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 41 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#一spring简介">一、Spring简介</a>
      <ul>
        <li>
          <ul>
            <li><a href="#11-目前我们代码存在的问题">1.1 目前我们代码存在的问题</a></li>
            <li><a href="#12-核心概念">1.2 核心概念</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#二ioc和di入门案例重点">二、IOC和DI入门案例【重点】</a>
      <ul>
        <li><a href="#1-ioc入门案例重点">1 IOC入门案例【重点】</a>
          <ul>
            <li><a href="#问题导入">问题导入</a></li>
            <li><a href="#11-门案例思路分析">1.1 门案例思路分析</a></li>
            <li><a href="#12-实现步骤">1.2 实现步骤</a></li>
            <li><a href="#13-实现代码">1.3 实现代码</a></li>
            <li><a href="#14-运行结果">1.4 运行结果</a></li>
          </ul>
        </li>
        <li><a href="#2-di入门案例重点">2 DI入门案例【重点】</a>
          <ul>
            <li><a href="#问题导入-1">问题导入</a></li>
            <li><a href="#21-di入门案例思路分析">2.1 DI入门案例思路分析</a></li>
            <li><a href="#22-实现步骤">2.2 实现步骤</a></li>
            <li><a href="#23-实现代码">2.3 实现代码</a></li>
            <li><a href="#24-图解演示">2.4 图解演示</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#三bean的基础配置">三、Bean的基础配置</a>
      <ul>
        <li><a href="#问题导入-2">问题导入</a></li>
        <li><a href="#1-bean基础配置重点">1 Bean基础配置【重点】</a>
          <ul>
            <li><a href="#配置说明">配置说明</a></li>
            <li><a href="#代码演示">代码演示</a></li>
            <li><a href="#运行结果">运行结果</a></li>
          </ul>
        </li>
        <li><a href="#2-bean别名配置">2 Bean别名配置</a>
          <ul>
            <li><a href="#配置说明-1">配置说明</a></li>
            <li><a href="#代码演示-1">代码演示</a></li>
            <li><a href="#打印结果">打印结果</a></li>
          </ul>
        </li>
        <li><a href="#3-bean作用范围配置重点">3 Bean作用范围配置【重点】</a>
          <ul>
            <li><a href="#配置说明-2">配置说明</a></li>
            <li><a href="#代码演示-2">代码演示</a></li>
            <li><a href="#打印结果-1">打印结果</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#四bean的实例化">四、Bean的实例化</a>
      <ul>
        <li><a href="#问题导入-3">问题导入</a></li>
        <li><a href="#1-bean是如何创建的理解">1 Bean是如何创建的【理解】</a></li>
        <li><a href="#2-实例化bean的三种方式">2 实例化Bean的三种方式</a>
          <ul>
            <li><a href="#21-构造方法方式重点">2.1 构造方法方式【重点】</a></li>
            <li><a href="#22-静态工厂方式">2.2 静态工厂方式</a></li>
            <li><a href="#23-实例工厂方式">2.3 实例工厂方式</a></li>
            <li><a href="#24-实现factorybeant方式扩展了解">2.4 实现FactoryBean&lt;T&gt;方式【扩展,了解】</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#五bean的生命周期了解">五、Bean的生命周期【了解】</a>
      <ul>
        <li><a href="#问题导入-4">问题导入</a></li>
        <li><a href="#1-生命周期相关概念介绍">1 生命周期相关概念介绍</a></li>
        <li><a href="#2-代码演示">2 代码演示</a>
          <ul>
            <li><a href="#21-bean生命周期控制">2.1 Bean生命周期控制</a></li>
            <li><a href="#22-bean生命周期控制">2.2 Bean生命周期控制</a></li>
          </ul>
        </li>
        <li><a href="#3-bean销毁时机">3 Bean销毁时机</a></li>
      </ul>
    </li>
    <li><a href="#六依赖注入di配置">六、依赖注入(DI配置)</a>
      <ul>
        <li><a href="#1-依赖注入方式重点">1 依赖注入方式【重点】</a>
          <ul>
            <li><a href="#问题导入-5">问题导入</a></li>
            <li><a href="#11-依赖注入的两种方式">1.1 依赖注入的两种方式</a></li>
            <li><a href="#12-setter方式注入">1.2 setter方式注入</a>
              <ul>
                <li><a href="#问题导入-6">问题导入</a></li>
                <li><a href="#引用类型">引用类型</a></li>
                <li><a href="#简单类型">简单类型</a></li>
              </ul>
            </li>
            <li><a href="#13-构造方式注入">1.3 构造方式注入</a>
              <ul>
                <li><a href="#问题导入-7">问题导入</a></li>
                <li><a href="#引用类型-1">引用类型</a></li>
                <li><a href="#简单类型-1">简单类型</a></li>
                <li><a href="#参数适配了解">参数适配【了解】</a></li>
              </ul>
            </li>
            <li><a href="#14-依赖注入方式选择">1.4 依赖注入方式选择</a></li>
          </ul>
        </li>
        <li><a href="#2-依赖自动装配理解">2 依赖自动装配【理解】</a>
          <ul>
            <li><a href="#问题导入-8">问题导入</a></li>
            <li><a href="#21-自动装配概念">2.1 自动装配概念</a></li>
            <li><a href="#22-自动装配类型">2.2 自动装配类型</a>
              <ul>
                <li><a href="#依赖自动装配">依赖自动装配</a></li>
                <li><a href="#依赖自动装配特征">依赖自动装配特征</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#3-集合注入">3 集合注入</a>
          <ul>
            <li><a href="#31-注入数组类型数据">3.1 注入数组类型数据</a></li>
            <li><a href="#32-注入list类型数据">3.2 注入List类型数据</a></li>
            <li><a href="#33-注入set类型数据">3.3 注入Set类型数据</a></li>
            <li><a href="#34-注入map类型数据">3.4 注入Map类型数据</a></li>
            <li><a href="#35-注入properties类型数据">3.5 注入Properties类型数据</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#四第三方资源配置管理">四、第三方资源配置管理</a>
      <ul>
        <li><a href="#1-管理datasource连接池对象">1 管理DataSource连接池对象</a>
          <ul>
            <li><a href="#问题导入-9">问题导入</a></li>
            <li><a href="#11-管理druid连接池重点">1.1 管理Druid连接池【重点】</a></li>
            <li><a href="#12-管理c3p0连接池">1.2 管理c3p0连接池</a></li>
          </ul>
        </li>
        <li><a href="#2-加载properties属性文件重点">2 加载properties属性文件【重点】</a>
          <ul>
            <li><a href="#问题导入-10">问题导入</a></li>
            <li><a href="#21-基本用法">2.1 基本用法</a></li>
            <li><a href="#22-配置不加载系统属性">2.2 配置不加载系统属性</a></li>
            <li><a href="#23-加载properties文件写法">2.3 加载properties文件写法</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#五spring容器">五、Spring容器</a>
      <ul>
        <li><a href="#1-spring核心容器介绍">1 Spring核心容器介绍</a>
          <ul>
            <li><a href="#问题导入-11">问题导入</a></li>
            <li><a href="#11-创建容器">1.1 创建容器</a></li>
            <li><a href="#12-获取bean对象">1.2 获取bean对象</a></li>
            <li><a href="#13-容器类层次结构">1.3 容器类层次结构</a></li>
            <li><a href="#14-beanfactory">1.4 BeanFactory</a></li>
          </ul>
        </li>
        <li><a href="#2-spring核心容器总结">2 Spring核心容器总结</a>
          <ul>
            <li><a href="#21-容器相关">2.1 容器相关</a></li>
            <li><a href="#22-bean相关">2.2 bean相关</a></li>
            <li><a href="#23-依赖注入相关">2.3 依赖注入相关</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#六spring注解开发">六、Spring注解开发</a>
      <ul>
        <li><a href="#1-注解开发定义bean对象重点">1 注解开发定义Bean对象【重点】</a>
          <ul>
            <li><a href="#问题导入-12">问题导入</a></li>
            <li><a href="#11-基本使用">1.1 基本使用</a></li>
            <li><a href="#12-component三个衍生注解">1.2 @Component三个衍生注解</a></li>
          </ul>
        </li>
        <li><a href="#2-纯注解开发模式重点">2 纯注解开发模式【重点】</a>
          <ul>
            <li><a href="#问题导入-13">问题导入</a></li>
            <li><a href="#21-纯注解开发模式介绍">2.1 纯注解开发模式介绍</a></li>
            <li><a href="#22-代码演示">2.2 代码演示</a></li>
          </ul>
        </li>
        <li><a href="#3-注解开发bean作用范围和生命周期管理">3 注解开发Bean作用范围和生命周期管理</a>
          <ul>
            <li><a href="#问题导入-14">问题导入</a></li>
            <li><a href="#31-bean作用范围注解配置">3.1 bean作用范围注解配置</a></li>
            <li><a href="#32-bean生命周期注解配置">3.2 bean生命周期注解配置</a></li>
          </ul>
        </li>
        <li><a href="#4-注解开发依赖注入重点">4 注解开发依赖注入【重点】</a>
          <ul>
            <li><a href="#问题导入-15">问题导入</a></li>
            <li><a href="#41-使用autowired注解开启自动装配模式按类型">4.1 使用@Autowired注解开启自动装配模式（按类型）</a></li>
            <li><a href="#42-使用qualifier注解指定要装配的bean名称">4.2 使用@Qualifier注解指定要装配的bean名称</a></li>
            <li><a href="#43-使用value实现简单类型注入">4.3 使用@Value实现简单类型注入</a></li>
          </ul>
        </li>
        <li><a href="#5-注解开发管理第三方bean重点">5 注解开发管理第三方Bean【重点】</a>
          <ul>
            <li><a href="#问题导入-16">问题导入</a></li>
            <li><a href="#第一步单独定义配置类"><strong>【第一步】单独定义配置类</strong></a></li>
            <li><a href="#第二步将独立的配置类加入核心配置"><strong>【第二步】将独立的配置类加入核心配置</strong></a>
              <ul>
                <li><a href="#方式1import注解导入式">方式1：@Import注解导入式</a></li>
                <li><a href="#方式2componentscan扫描式">方式2：@ComponentScan扫描式</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#6-注解开发为第三方bean注入资源重点">6 注解开发为第三方Bean注入资源【重点】</a>
          <ul>
            <li><a href="#问题导入-17">问题导入</a></li>
            <li><a href="#61-简单类型依赖注入">6.1 简单类型依赖注入</a></li>
            <li><a href="#62-引用类型依赖注入">6.2 引用类型依赖注入</a></li>
          </ul>
        </li>
        <li><a href="#7-注解开发总结">7 注解开发总结</a></li>
      </ul>
    </li>
    <li><a href="#七spring整合其他技术重点">七、Spring整合其他技术【重点】</a>
      <ul>
        <li><a href="#1-spring整合mybatis重点">1 Spring整合mybatis【重点】</a>
          <ul>
            <li><a href="#11-思路分析">1.1 思路分析</a>
              <ul>
                <li><a href="#问题导入-18">问题导入</a></li>
                <li><a href="#111-mybatis程序核心对象分析">1.1.1 MyBatis程序核心对象分析</a></li>
                <li><a href="#112-整合mybatis">1.1.2 整合MyBatis</a></li>
              </ul>
            </li>
            <li><a href="#12-代码实现">1.2 代码实现</a>
              <ul>
                <li><a href="#问题导入-19">问题导入</a></li>
                <li><a href="#前置工作">【前置工作】</a></li>
                <li><a href="#第一步导入spring整合mybatis依赖java17"><strong>【第一步】导入Spring整合Mybatis依赖</strong>(JAVA17)</a></li>
                <li><a href="#第二步创建jdbcconfig配置datasource数据源"><strong>【第二步】创建JdbcConfig配置DataSource数据源</strong></a></li>
                <li><a href="#第三步创建mybatisconfig整合mybatis"><strong>【第三步】创建MybatisConfig整合mybatis</strong></a></li>
                <li><a href="#第四步创建springconfig主配置类进行包扫描和加载其他配置类"><strong>【第四步】创建SpringConfig主配置类进行包扫描和加载其他配置类</strong></a></li>
                <li><a href="#第五步定义测试类进行测试"><strong>【第五步】定义测试类进行测试</strong></a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#2-spring整合junit单元测试重点">2 Spring整合Junit单元测试【重点】</a>
          <ul>
            <li><a href="#问题导入-20">问题导入</a></li>
            <li><a href="#第一步导入整合的依赖坐标spring-test">【第一步】导入整合的依赖坐标spring-test</a></li>
            <li><a href="#第二步使用spring整合junit专用的类加载器">【第二步】使用Spring整合Junit专用的类加载器</a></li>
            <li><a href="#第三步加载配置文件或者配置类">【第三步】加载配置文件或者配置类</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#八aop">八、AOP</a>
      <ul>
        <li><a href="#1-aop简介">1 AOP简介</a>
          <ul>
            <li><a href="#问题导入-21">问题导入</a></li>
            <li><a href="#11-aop简介和作用理解">1.1 AOP简介和作用【理解】</a></li>
            <li><a href="#12-aop中的核心概念理解">1.2 AOP中的核心概念【理解】</a></li>
          </ul>
        </li>
        <li><a href="#2-aop入门案例重点">2 AOP入门案例【重点】</a>
          <ul>
            <li><a href="#问题导入-22">问题导入</a></li>
            <li><a href="#21-aop入门案例思路分析">2.1 AOP入门案例思路分析</a></li>
            <li><a href="#22-aop入门案例实现">2.2 AOP入门案例实现</a>
              <ul>
                <li><a href="#第一步导入aop相关坐标">【第一步】导入aop相关坐标</a></li>
                <li><a href="#第二步定义dao接口与实现类">【第二步】定义dao接口与实现类</a></li>
                <li><a href="#第三步定义通知类制作通知方法">【第三步】定义通知类，制作通知方法</a></li>
                <li><a href="#第四步定义切入点表达式配置切面绑定切入点与通知关系">【第四步】定义切入点表达式、配置切面(绑定切入点与通知关系)</a></li>
                <li><a href="#第五步在配置类中进行spring注解包扫描和开启aop功能">【第五步】在配置类中进行Spring注解包扫描和开启AOP功能</a></li>
                <li><a href="#测试类和运行结果">测试类和运行结果</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#3-aop工作流程理解">3 AOP工作流程【理解】</a>
          <ul>
            <li><a href="#问题导入-23">问题导入</a></li>
            <li><a href="#31-aop工作流程">3.1 AOP工作流程</a></li>
            <li><a href="#32-aop核心概念">3.2 AOP核心概念</a></li>
            <li><a href="#33-在测试类中验证代理对象">3.3 在测试类中验证代理对象</a></li>
          </ul>
        </li>
        <li><a href="#4-aop切入点表达式">4 AOP切入点表达式</a>
          <ul>
            <li><a href="#问题导入-24">问题导入</a></li>
            <li><a href="#41-语法格式">4.1 语法格式</a></li>
            <li><a href="#42-通配符">4.2 通配符</a></li>
            <li><a href="#43-书写技巧">4.3 书写技巧</a></li>
          </ul>
        </li>
        <li><a href="#5-aop通知类型重点">5 AOP通知类型【重点】</a>
          <ul>
            <li><a href="#问题导入-25">问题导入</a></li>
            <li><a href="#51-aop通知分类">5.1 AOP通知分类</a></li>
            <li><a href="#52-aop通知详解">5.2 AOP通知详解</a>
              <ul>
                <li><a href="#521-前置通知">5.2.1 前置通知</a></li>
                <li><a href="#522-后置通知">5.2.2 后置通知</a></li>
                <li><a href="#523-返回后通知">5.2.3 返回后通知</a></li>
                <li><a href="#524-抛出异常后通知">5.2.4 抛出异常后通知</a></li>
                <li><a href="#525-环绕通知">5.2.5 环绕通知</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#九aop案例">九、AOP案例</a>
      <ul>
        <li><a href="#1-案例-测量业务层接口万次执行效率">1 案例-测量业务层接口万次执行效率</a>
          <ul>
            <li><a href="#问题导入-26">问题导入</a></li>
            <li><a href="#11-需求和分析">1.1 需求和分析</a></li>
            <li><a href="#12-代码实现-1">1.2 代码实现</a>
              <ul>
                <li><a href="#前置工作环境准备">【前置工作】环境准备</a></li>
                <li><a href="#第一步编写通知类">【第一步】编写通知类</a></li>
                <li><a href="#第二步在springconfig配置类上开启aop注解功能">【第二步】在SpringConfig配置类上开启AOP注解功能</a></li>
                <li><a href="#第三步运行测试类查看结果">【第三步】运行测试类，查看结果</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#2-aop切入点数据获取">2 AOP切入点数据获取</a>
          <ul>
            <li><a href="#问题导入-27">问题导入</a></li>
            <li><a href="#21-获取参数">2.1 获取参数</a></li>
            <li><a href="#22-获取返回值">2.2 获取返回值</a></li>
            <li><a href="#23-获取异常">2.3 获取异常</a></li>
          </ul>
        </li>
        <li><a href="#3-案例-百度网盘密码数据兼容处理">3 案例-百度网盘密码数据兼容处理</a>
          <ul>
            <li><a href="#问题导入-28">问题导入</a></li>
            <li><a href="#31-需求和分析">3.1 需求和分析</a></li>
            <li><a href="#32-代码实现">3.2 代码实现</a>
              <ul>
                <li><a href="#前置工作环境准备-1">【前置工作】环境准备</a></li>
                <li><a href="#第一步编写通知类-1">【第一步】编写通知类</a></li>
                <li><a href="#第二步在springconfig配置类上开启aop注解功能-1">【第二步】在SpringConfig配置类上开启AOP注解功能</a></li>
                <li><a href="#第三步运行测试类查看结果-1">【第三步】运行测试类，查看结果</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#4-aop开发总结">4 AOP开发总结</a>
          <ul>
            <li><a href="#41-aop的核心概念">4.1 AOP的核心概念</a></li>
            <li><a href="#42-切入点表达式语法">4.2 切入点表达式语法</a></li>
            <li><a href="#43-五种通知类型">4.3 五种通知类型</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#十spring事务管理">十、Spring事务管理</a>
      <ul>
        <li><a href="#1-spring事务简介重点">1 Spring事务简介【重点】</a>
          <ul>
            <li><a href="#问题导入-29">问题导入</a></li>
            <li><a href="#11-spring事务作用">1.1 Spring事务作用</a></li>
            <li><a href="#12-需求和分析">1.2 需求和分析</a></li>
            <li><a href="#13-代码实现">1.3 代码实现</a>
              <ul>
                <li><a href="#前置工作环境准备-2">【前置工作】环境准备</a></li>
                <li><a href="#第一步在业务层接口上添加spring事务管理">【第一步】在业务层接口上添加Spring事务管理</a></li>
                <li><a href="#第二步设置事务管理器将事务管理器添加到ioc容器中">【第二步】设置事务管理器(将事务管理器添加到IOC容器中)</a></li>
                <li><a href="#第三步开启注解式事务驱动">【第三步】开启注解式事务驱动</a></li>
                <li><a href="#第四步运行测试类查看结果">【第四步】运行测试类，查看结果</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#2-spring事务角色理解">2 Spring事务角色【理解】</a>
          <ul>
            <li><a href="#问题导入-30">问题导入</a></li>
            <li><a href="#21-spring事务角色">2.1 Spring事务角色</a></li>
          </ul>
        </li>
        <li><a href="#3-spring事务相关配置">3 Spring事务相关配置</a>
          <ul>
            <li><a href="#问题导入-31">问题导入</a></li>
            <li><a href="#31-事务配置">3.1 事务配置</a></li>
            <li><a href="#32-案例转账业务追加日志">3.2 案例：转账业务追加日志</a>
              <ul>
                <li><a href="#需求和分析">需求和分析</a></li>
                <li><a href="#准备工作环境整备">【准备工作】环境整备</a></li>
                <li><a href="#第一步在accountserviceimpl中调用logservice中添加日志的方法">【第一步】在AccountServiceImpl中调用logService中添加日志的方法</a></li>
                <li><a href="#第二步在logservice的log方法上设置事务的传播行为">【第二步】在LogService的log()方法上设置事务的传播行为</a></li>
                <li><a href="#第三步运行测试类查看结果-2">【第三步】运行测试类，查看结果</a></li>
              </ul>
            </li>
            <li><a href="#33-事务传播行为">3.3 事务传播行为</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><div class="details admonition warning open">
                <div class="details-summary admonition-title">
                    <i class="icon fas fa-exclamation-triangle fa-fwwarning"></i>警告<i class="details-icon fas fa-angle-right fa-fw"></i>
                </div>
                <div class="details-content">
                    <div class="admonition-content">
                        本文最后更新于 <span class="timeago" datetime="2023-12-31T20:33:49" title="December 31, 2023">2023-12-31</span>，文中内容可能已过时。</div>
                </div>
            </div><h2 id="一spring简介" class="headerLink">
    <a href="#%e4%b8%80spring%e7%ae%80%e4%bb%8b" class="header-mark"></a>一、Spring简介</h2><h4 id="11-目前我们代码存在的问题" class="headerLink">
    <a href="#11-%e7%9b%ae%e5%89%8d%e6%88%91%e4%bb%ac%e4%bb%a3%e7%a0%81%e5%ad%98%e5%9c%a8%e7%9a%84%e9%97%ae%e9%a2%98" class="header-mark"></a>1.1 目前我们代码存在的问题</h4><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331234.png" title="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331234.png" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331234.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331234.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331234.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331234.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331234.png 2x"
            sizes="auto"
            alt="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331234.png">
    </a></figure></p>
<ul>
<li>代码书写现状
<ul>
<li>耦合度偏高</li>
</ul>
</li>
<li>解决方案
<ul>
<li>使用对象时，在程序中不要主动使用new产生对象，转换为由外部提供对象</li>
</ul>
</li>
</ul>
<h4 id="12-核心概念" class="headerLink">
    <a href="#12-%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5" class="header-mark"></a>1.2 核心概念</h4><ul>
<li>
<p>==IOC（Inversion of Control）控制反转==</p>
<p>使用对象时，由主动new产生对象转换为由==外部==提供对象，此过程中对象创建控制权由程序转移到外部，此思想称为控制反转。通俗的讲就是“==将new对象的权利交给Spring，我们从Spring中获取对象使用即可==”</p>
</li>
<li>
<p>Spring技术对IoC思想进行了实现</p>
<ul>
<li>Spring提供了一个容器，称为==IOC容器==，用来充当IoC思想中的“外部”</li>
<li>IOC容器负责对象的创建、初始化等一系列工作，被创建或被管理的对象在IoC容器中统称为==Bean==</li>
</ul>
</li>
<li>
<p>==DI（Dependency Injection）依赖注入==</p>
<ul>
<li>在容器中建立bean与bean之间的依赖关系的整个过程，称为依赖注入。</li>
</ul>
</li>
</ul>
<p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331218.png" title="image-20210729174148134" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331218.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331218.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331218.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331218.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331218.png 2x"
            sizes="auto"
            alt="image-20210729174148134">
    </a></figure></p>
<ul>
<li>目标：充分解耦
<ul>
<li>使用IoC容器管理bean（IOC)</li>
<li>在IoC容器内将有依赖关系的bean进行关系绑定（DI）</li>
</ul>
</li>
<li>最终效果
<ul>
<li>使用对象时不仅可以直接从IoC容器中获取，并且获取到的bean已经绑定了所有的依赖关系</li>
</ul>
</li>
</ul>
<h2 id="二ioc和di入门案例重点" class="headerLink">
    <a href="#%e4%ba%8cioc%e5%92%8cdi%e5%85%a5%e9%97%a8%e6%a1%88%e4%be%8b%e9%87%8d%e7%82%b9" class="header-mark"></a>二、IOC和DI入门案例【重点】</h2><h3 id="1-ioc入门案例重点" class="headerLink">
    <a href="#1-ioc%e5%85%a5%e9%97%a8%e6%a1%88%e4%be%8b%e9%87%8d%e7%82%b9" class="header-mark"></a>1 IOC入门案例【重点】</h3><h4 id="问题导入" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5" class="header-mark"></a>问题导入</h4><p>&lt;bean&gt;标签中id属性和class属性的作用是什么？</p>
<h4 id="11-门案例思路分析" class="headerLink">
    <a href="#11-%e9%97%a8%e6%a1%88%e4%be%8b%e6%80%9d%e8%b7%af%e5%88%86%e6%9e%90" class="header-mark"></a>1.1 门案例思路分析</h4><ol>
<li>管理什么？(Service与Dao)</li>
<li>如何将被管理的对象告知IOC容器？(配置文件)</li>
<li>被管理的对象交给IOC容器，如何获取到IoC容器？(接口)</li>
<li>IOC容器得到后，如何从容器中获取bean？(接口方法)</li>
<li>使用Spring导入哪些坐标？(pom.xml)</li>
</ol>
<h4 id="12-实现步骤" class="headerLink">
    <a href="#12-%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4" class="header-mark"></a>1.2 实现步骤</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">【第一步】导入Spring坐标
</span></span><span class="line"><span class="cl">【第二步】定义Spring管理的类（接口）
</span></span><span class="line"><span class="cl">【第三步】创建Spring配置文件，配置对应类作为Spring管理的bean对象
</span></span><span class="line"><span class="cl">【第四步】初始化IOC容器（Spring核心容器/Spring容器），通过容器获取bean对象
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="13-实现代码" class="headerLink">
    <a href="#13-%e5%ae%9e%e7%8e%b0%e4%bb%a3%e7%a0%81" class="header-mark"></a>1.3 实现代码</h4><p><strong>【第一步】导入Spring坐标</strong></p>
<p>jdk8</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--导入spring的坐标spring-context，对应版本是5.2.10.RELEASE--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>5.2.10.RELEASE<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>jdk17</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">  <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-test<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;version&gt;</span>5.3.10<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>【第二步】定义Spring管理的类（接口）</strong></p>
<ul>
<li>BookDao接口和BookDaoImpl实现类</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">BookDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookDaoImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BookDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;book dao save ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>BookService接口和BookServiceImpl实现类</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">BookService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BookService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BookDaoImpl</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;book service save ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">bookDao</span><span class="p">.</span><span class="na">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>【第三步】创建Spring配置文件，配置对应类作为Spring管理的bean对象</strong></p>
<ul>
<li>定义applicationContext.xml配置文件并配置BookServiceImpl</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--
</span></span></span><span class="line"><span class="cl"><span class="c">		bean标签：表示配置bean
</span></span></span><span class="line"><span class="cl"><span class="c">    	id属性：表示给bean起名字
</span></span></span><span class="line"><span class="cl"><span class="c">    	class属性：表示给bean定义类型
</span></span></span><span class="line"><span class="cl"><span class="c">	--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;bookService&#34;</span> <span class="na">class=</span><span class="s">&#34;com.itghd.service.impl.BookServiceImpl&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/beans&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>==注意事项：bean定义时id属性在同一个上下文中(IOC容器中)不能重复==</strong></p>
<p><strong>【第四步】初始化IOC容器（Spring核心容器/Spring容器），通过容器获取Bean对象</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">App</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//1.创建IoC容器对象，加载spring核心配置文件</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClassPathXmlApplicationContext</span><span class="p">(</span><span class="s">&#34;applicationContext.xml&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//2 从IOC容器中获取Bean对象(BookService对象)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">BookService</span><span class="w"> </span><span class="n">bookService</span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BookService</span><span class="p">)</span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&#34;bookService&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//3 调用Bean对象(BookService对象)的方法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">bookService</span><span class="p">.</span><span class="na">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="14-运行结果" class="headerLink">
    <a href="#14-%e8%bf%90%e8%a1%8c%e7%bb%93%e6%9e%9c" class="header-mark"></a>1.4 运行结果</h4><p><figure><a class="lightgallery" href="D:%5c%e6%96%b0%e5%bb%ba%e6%96%87%e4%bb%b6%e5%a4%b9%5c_posts%5cimage-20210729184337603.png" title="image-20210729184337603" data-thumbnail="D:\新建文件夹\_posts\image-20210729184337603.png">
        <img
            
            loading="lazy"
            src="D:%5c%e6%96%b0%e5%bb%ba%e6%96%87%e4%bb%b6%e5%a4%b9%5c_posts%5cimage-20210729184337603.png"
            srcset="D:%5c%e6%96%b0%e5%bb%ba%e6%96%87%e4%bb%b6%e5%a4%b9%5c_posts%5cimage-20210729184337603.png, D:%5c%e6%96%b0%e5%bb%ba%e6%96%87%e4%bb%b6%e5%a4%b9%5c_posts%5cimage-20210729184337603.png 1.5x, D:%5c%e6%96%b0%e5%bb%ba%e6%96%87%e4%bb%b6%e5%a4%b9%5c_posts%5cimage-20210729184337603.png 2x"
            sizes="auto"
            alt="image-20210729184337603">
    </a></figure></p>
<h3 id="2-di入门案例重点" class="headerLink">
    <a href="#2-di%e5%85%a5%e9%97%a8%e6%a1%88%e4%be%8b%e9%87%8d%e7%82%b9" class="header-mark"></a>2 DI入门案例【重点】</h3><h4 id="问题导入-1" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-1" class="header-mark"></a>问题导入</h4><p>&lt;property&gt;标签中name属性和ref属性的作用是什么？</p>
<h4 id="21-di入门案例思路分析" class="headerLink">
    <a href="#21-di%e5%85%a5%e9%97%a8%e6%a1%88%e4%be%8b%e6%80%9d%e8%b7%af%e5%88%86%e6%9e%90" class="header-mark"></a>2.1 DI入门案例思路分析</h4><ol>
<li>基于IOC管理bean</li>
<li>Service中使用new形式创建的Dao对象是否保留？(否)</li>
<li>Service中需要的Dao对象如何进入到Service中？(提供方法)</li>
<li>Service与Dao间的关系如何描述？(配置)</li>
</ol>
<h4 id="22-实现步骤" class="headerLink">
    <a href="#22-%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4" class="header-mark"></a>2.2 实现步骤</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">【第一步】删除使用new的形式创建对象的代码
</span></span><span class="line"><span class="cl">【第二步】提供依赖对象对应的setter方法
</span></span><span class="line"><span class="cl">【第三步】配置service与dao之间的关系
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="23-实现代码" class="headerLink">
    <a href="#23-%e5%ae%9e%e7%8e%b0%e4%bb%a3%e7%a0%81" class="header-mark"></a>2.3 实现代码</h4><p><strong>【第一步】删除使用new的形式创建对象的代码</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BookService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="p">;</span><span class="w">  </span><span class="c1">//【第一步】删除使用new的形式创建对象的代码</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;book service save ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">bookDao</span><span class="p">.</span><span class="na">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>【第二步】提供依赖对象对应的setter方法</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BookService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;book service save ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">bookDao</span><span class="p">.</span><span class="na">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//【第二步】提供依赖对象对应的setter方法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setBookDao</span><span class="p">(</span><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">bookDao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bookDao</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>【第三步】配置service与dao之间的关系</strong></p>
<blockquote>
<p>在applicationContext.xml中配置</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--
</span></span></span><span class="line"><span class="cl"><span class="c">		bean标签：表示配置bean
</span></span></span><span class="line"><span class="cl"><span class="c">    	id属性：表示给bean起名字
</span></span></span><span class="line"><span class="cl"><span class="c">    	class属性：表示给bean定义类型
</span></span></span><span class="line"><span class="cl"><span class="c">	--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;bookDao&#34;</span> <span class="na">class=</span><span class="s">&#34;com.itghd.dao.impl.BookDaoImpl&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;bookService&#34;</span> <span class="na">class=</span><span class="s">&#34;com.itghd.service.impl.BookServiceImpl&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--配置server与dao的关系
</span></span></span><span class="line"><span class="cl"><span class="c">			property标签：表示配置当前bean的属性
</span></span></span><span class="line"><span class="cl"><span class="c">        	name属性：表示配置哪一个具体的属性
</span></span></span><span class="line"><span class="cl"><span class="c">        	ref属性：表示参照哪一个bean
</span></span></span><span class="line"><span class="cl"><span class="c">		--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;bookDao&#34;</span> <span class="na">ref=</span><span class="s">&#34;bookDao&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/bean&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/beans&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="24-图解演示" class="headerLink">
    <a href="#24-%e5%9b%be%e8%a7%a3%e6%bc%94%e7%a4%ba" class="header-mark"></a>2.4 图解演示</h4><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331460.png" title="image-20210729183104748" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331460.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331460.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331460.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331460.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331460.png 2x"
            sizes="auto"
            alt="image-20210729183104748">
    </a></figure></p>
<h2 id="三bean的基础配置" class="headerLink">
    <a href="#%e4%b8%89bean%e7%9a%84%e5%9f%ba%e7%a1%80%e9%85%8d%e7%bd%ae" class="header-mark"></a>三、Bean的基础配置</h2><h3 id="问题导入-2" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-2" class="header-mark"></a>问题导入</h3><p>问题1：在&lt;bean&gt;标签上如何配置别名？</p>
<p>问题2：Bean的默认作用范围是什么？如何修改？</p>
<h3 id="1-bean基础配置重点" class="headerLink">
    <a href="#1-bean%e5%9f%ba%e7%a1%80%e9%85%8d%e7%bd%ae%e9%87%8d%e7%82%b9" class="header-mark"></a>1 Bean基础配置【重点】</h3><h4 id="配置说明" class="headerLink">
    <a href="#%e9%85%8d%e7%bd%ae%e8%af%b4%e6%98%8e" class="header-mark"></a>配置说明</h4><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331294.png" title="image-20210729183500978" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331294.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331294.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331294.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331294.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331294.png 2x"
            sizes="auto"
            alt="image-20210729183500978">
    </a></figure></p>
<h4 id="代码演示" class="headerLink">
    <a href="#%e4%bb%a3%e7%a0%81%e6%bc%94%e7%a4%ba" class="header-mark"></a>代码演示</h4><blockquote>
<p>见《IOC入门案例》applicationContext.xml配置</p>
</blockquote>
<h4 id="运行结果" class="headerLink">
    <a href="#%e8%bf%90%e8%a1%8c%e7%bb%93%e6%9e%9c" class="header-mark"></a>运行结果</h4><blockquote>
<p>见《IOC入门案例》运行结果</p>
</blockquote>
<h3 id="2-bean别名配置" class="headerLink">
    <a href="#2-bean%e5%88%ab%e5%90%8d%e9%85%8d%e7%bd%ae" class="header-mark"></a>2 Bean别名配置</h3><h4 id="配置说明-1" class="headerLink">
    <a href="#%e9%85%8d%e7%bd%ae%e8%af%b4%e6%98%8e-1" class="header-mark"></a>配置说明</h4><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331205.png" title="image-20210729183558051" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331205.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331205.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331205.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331205.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331205.png 2x"
            sizes="auto"
            alt="image-20210729183558051">
    </a></figure></p>
<h4 id="代码演示-1" class="headerLink">
    <a href="#%e4%bb%a3%e7%a0%81%e6%bc%94%e7%a4%ba-1" class="header-mark"></a>代码演示</h4><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331252.png" title="image-20210729191924626" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331252.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331252.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331252.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331252.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331252.png 2x"
            sizes="auto"
            alt="image-20210729191924626">
    </a></figure></p>
<h4 id="打印结果" class="headerLink">
    <a href="#%e6%89%93%e5%8d%b0%e7%bb%93%e6%9e%9c" class="header-mark"></a>打印结果</h4><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331069.png" title="image-20210729191954870" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331069.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331069.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331069.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331069.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331069.png 2x"
            sizes="auto"
            alt="image-20210729191954870">
    </a></figure></p>
<h3 id="3-bean作用范围配置重点" class="headerLink">
    <a href="#3-bean%e4%bd%9c%e7%94%a8%e8%8c%83%e5%9b%b4%e9%85%8d%e7%bd%ae%e9%87%8d%e7%82%b9" class="header-mark"></a>3 Bean作用范围配置【重点】</h3><h4 id="配置说明-2" class="headerLink">
    <a href="#%e9%85%8d%e7%bd%ae%e8%af%b4%e6%98%8e-2" class="header-mark"></a>配置说明</h4><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331831.png" title="image-20210729183628138" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331831.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331831.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331831.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331831.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331831.png 2x"
            sizes="auto"
            alt="image-20210729183628138">
    </a></figure></p>
<blockquote>
<p>扩展：scope的取值不仅仅只有singleton和prototype，还有request、session、application、 websocket ，表示创建出的对象放置在web容器(tomcat)对应的位置。比如：request表示保存到request域中。</p>
</blockquote>
<h4 id="代码演示-2" class="headerLink">
    <a href="#%e4%bb%a3%e7%a0%81%e6%bc%94%e7%a4%ba-2" class="header-mark"></a>代码演示</h4><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331013.png" title="image-20210729192420048" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331013.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331013.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331013.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331013.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331013.png 2x"
            sizes="auto"
            alt="image-20210729192420048">
    </a></figure></p>
<h4 id="打印结果-1" class="headerLink">
    <a href="#%e6%89%93%e5%8d%b0%e7%bb%93%e6%9e%9c-1" class="header-mark"></a>打印结果</h4><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331876.png" title="image-20210729192730871" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331876.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331876.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331876.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331876.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331876.png 2x"
            sizes="auto"
            alt="image-20210729192730871">
    </a></figure></p>
<blockquote>
<p>最后给大家说明一下：在我们的实际开发当中，绝大部分的Bean是单例的，也就是说绝大部分Bean不需要配置scope属性。</p>
</blockquote>
<h2 id="四bean的实例化" class="headerLink">
    <a href="#%e5%9b%9bbean%e7%9a%84%e5%ae%9e%e4%be%8b%e5%8c%96" class="header-mark"></a>四、Bean的实例化</h2><h3 id="问题导入-3" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-3" class="header-mark"></a>问题导入</h3><p>Bean的实例化方式有几种？</p>
<h3 id="1-bean是如何创建的理解" class="headerLink">
    <a href="#1-bean%e6%98%af%e5%a6%82%e4%bd%95%e5%88%9b%e5%bb%ba%e7%9a%84%e7%90%86%e8%a7%a3" class="header-mark"></a>1 Bean是如何创建的【理解】</h3><p>bean本质上就是对象，创建bean使用构造方法完成</p>
<h3 id="2-实例化bean的三种方式" class="headerLink">
    <a href="#2-%e5%ae%9e%e4%be%8b%e5%8c%96bean%e7%9a%84%e4%b8%89%e7%a7%8d%e6%96%b9%e5%bc%8f" class="header-mark"></a>2 实例化Bean的三种方式</h3><h4 id="21-构造方法方式重点" class="headerLink">
    <a href="#21-%e6%9e%84%e9%80%a0%e6%96%b9%e6%b3%95%e6%96%b9%e5%bc%8f%e9%87%8d%e7%82%b9" class="header-mark"></a>2.1 构造方法方式【重点】</h4><ul>
<li>BookDaoImpl实现类</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookDaoImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BookDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">BookDaoImpl</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;book dao constructor is running ....&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;book dao save ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>applicationContext.xml配置</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--方式一：构造方法实例化bean--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;bookDao&#34;</span> <span class="na">class=</span><span class="s">&#34;com.itghd.dao.impl.BookDaoImpl&#34;</span><span class="nt">/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>AppForInstanceBook测试类</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppForInstanceBook</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClassPathXmlApplicationContext</span><span class="p">(</span><span class="s">&#34;applicationContext.xml&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BookDao</span><span class="p">)</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&#34;bookDao&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">bookDao</span><span class="p">.</span><span class="na">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>运行结果</li>
</ul>
<p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331908.png" title="image-20210729194137151" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331908.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331908.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331908.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331908.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331908.png 2x"
            sizes="auto"
            alt="image-20210729194137151">
    </a></figure></p>
<p>==注意：无参构造方法如果不存在，将抛出异常<code>BeanCreationException</code>==</p>
<h4 id="22-静态工厂方式" class="headerLink">
    <a href="#22-%e9%9d%99%e6%80%81%e5%b7%a5%e5%8e%82%e6%96%b9%e5%bc%8f" class="header-mark"></a>2.2 静态工厂方式</h4><ul>
<li>OrderDao接口和OrderDaoImpl实现类</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">OrderDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderDaoImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">OrderDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;order dao save ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>OrderDaoFatory工厂类</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//静态工厂创建对象</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderDaoFactory</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">OrderDao</span><span class="w"> </span><span class="nf">getOrderDao</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;factory setup....&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderDaoImpl</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>applicationContext.xml配置</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--方式二：使用静态工厂实例化bean--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;orderDao&#34;</span> <span class="na">class=</span><span class="s">&#34;com.itghd.factory.OrderDaoFactory&#34;</span> <span class="na">factory-method=</span><span class="s">&#34;getOrderDao&#34;</span><span class="nt">/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331026.png" title="image-20210729195248948" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331026.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331026.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331026.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331026.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331026.png 2x"
            sizes="auto"
            alt="image-20210729195248948">
    </a></figure></p>
<ul>
<li>AppForInstanceOrder测试类</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppForInstanceOrder</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClassPathXmlApplicationContext</span><span class="p">(</span><span class="s">&#34;applicationContext.xml&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">OrderDao</span><span class="w"> </span><span class="n">orderDao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">OrderDao</span><span class="p">)</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&#34;orderDao&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">orderDao</span><span class="p">.</span><span class="na">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>运行结果</li>
</ul>
<p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331266.png" title="image-20210729195009198" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331266.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331266.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331266.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331266.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331266.png 2x"
            sizes="auto"
            alt="image-20210729195009198">
    </a></figure></p>
<h4 id="23-实例工厂方式" class="headerLink">
    <a href="#23-%e5%ae%9e%e4%be%8b%e5%b7%a5%e5%8e%82%e6%96%b9%e5%bc%8f" class="header-mark"></a>2.3 实例工厂方式</h4><ul>
<li>UserDao接口和UserDaoImpl实现类</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UserDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserDaoImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">UserDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;user dao save ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>UserDaoFactory工厂类</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//实例工厂创建对象</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserDaoFactory</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">UserDao</span><span class="w"> </span><span class="nf">getUserDao</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserDaoImpl</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>applicationContext.xml配置</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--方式三：使用实例工厂实例化bean--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;userFactory&#34;</span> <span class="na">class=</span><span class="s">&#34;com.itghd.factory.UserDaoFactory&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;userDao&#34;</span> <span class="na">factory-method=</span><span class="s">&#34;getUserDao&#34;</span> <span class="na">factory-bean=</span><span class="s">&#34;userFactory&#34;</span><span class="nt">/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331413.png" title="image-20210729200203249" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331413.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331413.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331413.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331413.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331413.png 2x"
            sizes="auto"
            alt="image-20210729200203249">
    </a></figure></p>
<ul>
<li>AppForInstanceUser测试类</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppForInstanceUser</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//        //创建实例工厂对象</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//        UserDaoFactory userDaoFactory = new UserDaoFactory();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//        //通过实例工厂对象创建对象</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//        UserDao userDao = userDaoFactory.getUserDao();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//        userDao.save();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClassPathXmlApplicationContext</span><span class="p">(</span><span class="s">&#34;applicationContext.xml&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">UserDao</span><span class="w"> </span><span class="n">userDao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">UserDao</span><span class="p">)</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&#34;userDao&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">userDao</span><span class="p">.</span><span class="na">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>运行结果</li>
</ul>
<p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331427.png" title="image-20210729200240820" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331427.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331427.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331427.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331427.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331427.png 2x"
            sizes="auto"
            alt="image-20210729200240820">
    </a></figure></p>
<h4 id="24-实现factorybeant方式扩展了解" class="headerLink">
    <a href="#24-%e5%ae%9e%e7%8e%b0factorybeant%e6%96%b9%e5%bc%8f%e6%89%a9%e5%b1%95%e4%ba%86%e8%a7%a3" class="header-mark"></a>2.4 实现FactoryBean&lt;T&gt;方式【扩展,了解】</h4><ul>
<li>定义UserDaoFactoryBean实现FactoryBean&lt;UserDao&gt;</li>
</ul>
<blockquote>
<p>UserDaoFactoryBean中实例化什么类型的对象泛型就是该类型。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//FactoryBean创建对象</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserDaoFactoryBean</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">FactoryBean</span><span class="o">&lt;</span><span class="n">UserDao</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//代替原始实例工厂中创建对象的方法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">UserDao</span><span class="w"> </span><span class="nf">getObject</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserDaoImpl</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">getObjectType</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">UserDao</span><span class="p">.</span><span class="na">class</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>applicationContext.xml配置</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--方式四：使用FactoryBean实例化bean--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;userDao&#34;</span> <span class="na">class=</span><span class="s">&#34;com.itghd.factory.UserDaoFactoryBean&#34;</span><span class="nt">/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>使用之前的AppForInstanceUser测试类去运行看结果就行了。注意配置文件中id=&ldquo;userDao&quot;是否重复。</p>
</blockquote>
<h2 id="五bean的生命周期了解" class="headerLink">
    <a href="#%e4%ba%94bean%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e4%ba%86%e8%a7%a3" class="header-mark"></a>五、Bean的生命周期【了解】</h2><h3 id="问题导入-4" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-4" class="header-mark"></a>问题导入</h3><p>问题1：多例的Bean能够配置并执行销毁的方法？</p>
<p>问题2：如何做才执行Bean销毁的方法？</p>
<h3 id="1-生命周期相关概念介绍" class="headerLink">
    <a href="#1-%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e7%9b%b8%e5%85%b3%e6%a6%82%e5%bf%b5%e4%bb%8b%e7%bb%8d" class="header-mark"></a>1 生命周期相关概念介绍</h3><ul>
<li>生命周期：从创建到消亡的完整过程</li>
<li>bean生命周期：bean从创建到销毁的整体过程</li>
<li>bean生命周期控制：在bean创建后到销毁前做一些事情</li>
</ul>
<h3 id="2-代码演示" class="headerLink">
    <a href="#2-%e4%bb%a3%e7%a0%81%e6%bc%94%e7%a4%ba" class="header-mark"></a>2 代码演示</h3><h4 id="21-bean生命周期控制" class="headerLink">
    <a href="#21-bean%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e6%8e%a7%e5%88%b6" class="header-mark"></a>2.1 Bean生命周期控制</h4><ul>
<li>提供生命周期控制方法</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookDaoImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BookDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;book dao save ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//表示bean初始化对应的操作</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;init...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//表示bean销毁前对应的操作</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">destory</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;destory...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>applicationContext.xml配置</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--init-method：设置bean初始化生命周期回调函数,此处填写init方法名--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--destroy-method：设置bean销毁生命周期回调函数，仅适用于单例对象，此处填写destory方法名--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;bookDao&#34;</span> <span class="na">class=</span><span class="s">&#34;com.itghd.dao.impl.BookDaoImpl&#34;</span> <span class="na">init-method=</span><span class="s">&#34;init&#34;</span> <span class="na">destroy-method=</span><span class="s">&#34;destory&#34;</span><span class="nt">/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>测试类</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppForLifeCycle</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//此处需要使用实现类类型，接口类型没有close方法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ClassPathXmlApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClassPathXmlApplicationContext</span><span class="p">(</span><span class="s">&#34;applicationContext.xml&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BookDao</span><span class="p">)</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&#34;bookDao&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">bookDao</span><span class="p">.</span><span class="na">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//关闭容器，执行销毁的方法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ctx</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="22-bean生命周期控制" class="headerLink">
    <a href="#22-bean%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e6%8e%a7%e5%88%b6" class="header-mark"></a>2.2 Bean生命周期控制</h4><ul>
<li>实现InitializingBean, DisposableBean接口</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BookService</span><span class="p">,</span><span class="w"> </span><span class="n">InitializingBean</span><span class="p">,</span><span class="w"> </span><span class="n">DisposableBean</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setBookDao</span><span class="p">(</span><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;set .....&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">bookDao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bookDao</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;book service save ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">bookDao</span><span class="p">.</span><span class="na">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">destroy</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;service destroy&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">afterPropertiesSet</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;service init&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>测试类代码同《3.2.1 Bean生命周期控制》中的测试代码</p>
</blockquote>
<h3 id="3-bean销毁时机" class="headerLink">
    <a href="#3-bean%e9%94%80%e6%af%81%e6%97%b6%e6%9c%ba" class="header-mark"></a>3 Bean销毁时机</h3><ul>
<li>容器关闭前触发bean的销毁</li>
<li>关闭容器方式：
<ul>
<li>手工关闭容器
<code>ConfigurableApplicationContext</code>接口<code>close()</code>操作</li>
<li>注册关闭钩子，在虚拟机退出前先关闭容器再退出虚拟机
<code>ConfigurableApplicationContext</code>接口<code>registerShutdownHook()</code>操作</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppForLifeCycle</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//此处需要使用实现类类型，接口类型没有close方法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ClassPathXmlApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClassPathXmlApplicationContext</span><span class="p">(</span><span class="s">&#34;applicationContext.xml&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BookDao</span><span class="p">)</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&#34;bookDao&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">bookDao</span><span class="p">.</span><span class="na">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//注册关闭钩子函数，在虚拟机退出之前回调此函数，关闭容器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ctx</span><span class="p">.</span><span class="na">registerShutdownHook</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//关闭容器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//ctx.close();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="六依赖注入di配置" class="headerLink">
    <a href="#%e5%85%ad%e4%be%9d%e8%b5%96%e6%b3%a8%e5%85%a5di%e9%85%8d%e7%bd%ae" class="header-mark"></a>六、依赖注入(DI配置)</h2><h3 id="1-依赖注入方式重点" class="headerLink">
    <a href="#1-%e4%be%9d%e8%b5%96%e6%b3%a8%e5%85%a5%e6%96%b9%e5%bc%8f%e9%87%8d%e7%82%b9" class="header-mark"></a>1 依赖注入方式【重点】</h3><h4 id="问题导入-5" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-5" class="header-mark"></a>问题导入</h4><p>依赖注入有几种方式？</p>
<h4 id="11-依赖注入的两种方式" class="headerLink">
    <a href="#11-%e4%be%9d%e8%b5%96%e6%b3%a8%e5%85%a5%e7%9a%84%e4%b8%a4%e7%a7%8d%e6%96%b9%e5%bc%8f" class="header-mark"></a>1.1 依赖注入的两种方式</h4><ul>
<li>setter注入
简单类型
==<strong>引用类型(很常用)</strong>==</li>
<li>构造器注入
简单类型
引用类型</li>
</ul>
<h4 id="12-setter方式注入" class="headerLink">
    <a href="#12-setter%e6%96%b9%e5%bc%8f%e6%b3%a8%e5%85%a5" class="header-mark"></a>1.2 setter方式注入</h4><h5 id="问题导入-6" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-6" class="header-mark"></a>问题导入</h5><p>setter方式注入使用什么子标签？</p>
<h5 id="引用类型" class="headerLink">
    <a href="#%e5%bc%95%e7%94%a8%e7%b1%bb%e5%9e%8b" class="header-mark"></a>引用类型</h5><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331495.png" title="image-20210729203626540" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331495.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331495.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331495.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331495.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331495.png 2x"
            sizes="auto"
            alt="image-20210729203626540">
    </a></figure></p>
<h5 id="简单类型" class="headerLink">
    <a href="#%e7%ae%80%e5%8d%95%e7%b1%bb%e5%9e%8b" class="header-mark"></a>简单类型</h5><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331592.png" title="image-20210729203728173" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331592.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331592.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331592.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331592.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331592.png 2x"
            sizes="auto"
            alt="image-20210729203728173">
    </a></figure></p>
<h4 id="13-构造方式注入" class="headerLink">
    <a href="#13-%e6%9e%84%e9%80%a0%e6%96%b9%e5%bc%8f%e6%b3%a8%e5%85%a5" class="header-mark"></a>1.3 构造方式注入</h4><h5 id="问题导入-7" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-7" class="header-mark"></a>问题导入</h5><p>构造方式注入使用什么子标签？</p>
<h5 id="引用类型-1" class="headerLink">
    <a href="#%e5%bc%95%e7%94%a8%e7%b1%bb%e5%9e%8b-1" class="header-mark"></a>引用类型</h5><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331666.png" title="image-20210729203859855" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331666.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331666.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331666.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331666.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331666.png 2x"
            sizes="auto"
            alt="image-20210729203859855">
    </a></figure></p>
<h5 id="简单类型-1" class="headerLink">
    <a href="#%e7%ae%80%e5%8d%95%e7%b1%bb%e5%9e%8b-1" class="header-mark"></a>简单类型</h5><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331744.png" title="image-20210729204006542" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331744.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331744.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331744.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331744.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331744.png 2x"
            sizes="auto"
            alt="image-20210729204006542">
    </a></figure></p>
<h5 id="参数适配了解" class="headerLink">
    <a href="#%e5%8f%82%e6%95%b0%e9%80%82%e9%85%8d%e4%ba%86%e8%a7%a3" class="header-mark"></a>参数适配【了解】</h5><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331943.png" title="image-20210729204117697" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331943.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331943.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331943.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331943.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331943.png 2x"
            sizes="auto"
            alt="image-20210729204117697">
    </a></figure></p>
<h4 id="14-依赖注入方式选择" class="headerLink">
    <a href="#14-%e4%be%9d%e8%b5%96%e6%b3%a8%e5%85%a5%e6%96%b9%e5%bc%8f%e9%80%89%e6%8b%a9" class="header-mark"></a>1.4 依赖注入方式选择</h4><ol>
<li>强制依赖使用构造器进行，使用setter注入有概率不进行注入导致null对象出现</li>
<li>可选依赖使用setter注入进行，灵活性强</li>
<li>Spring框架倡导使用构造器，第三方框架内部大多数采用构造器注入的形式进行数据初始化，相对严谨</li>
<li>如果有必要可以两者同时使用，使用构造器注入完成强制依赖的注入，使用setter注入完成可选依赖的注入</li>
<li>实际开发过程中还要根据实际情况分析，如果受控对象没有提供setter方法就必须使用构造器注入</li>
<li><strong>==自己开发的模块推荐使用setter注入==</strong></li>
</ol>
<h3 id="2-依赖自动装配理解" class="headerLink">
    <a href="#2-%e4%be%9d%e8%b5%96%e8%87%aa%e5%8a%a8%e8%a3%85%e9%85%8d%e7%90%86%e8%a7%a3" class="header-mark"></a>2 依赖自动装配【理解】</h3><h4 id="问题导入-8" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-8" class="header-mark"></a>问题导入</h4><p>如何配置按照类型自动装配？</p>
<h4 id="21-自动装配概念" class="headerLink">
    <a href="#21-%e8%87%aa%e5%8a%a8%e8%a3%85%e9%85%8d%e6%a6%82%e5%bf%b5" class="header-mark"></a>2.1 自动装配概念</h4><ul>
<li>IoC容器根据bean所依赖的资源在容器中自动查找并注入到bean中的过程称为自动装配</li>
<li>自动装配方式
==按类型（常用）==
按名称
按构造方法
不启用自动装配</li>
</ul>
<h4 id="22-自动装配类型" class="headerLink">
    <a href="#22-%e8%87%aa%e5%8a%a8%e8%a3%85%e9%85%8d%e7%b1%bb%e5%9e%8b" class="header-mark"></a>2.2 自动装配类型</h4><h5 id="依赖自动装配" class="headerLink">
    <a href="#%e4%be%9d%e8%b5%96%e8%87%aa%e5%8a%a8%e8%a3%85%e9%85%8d" class="header-mark"></a>依赖自动装配</h5><blockquote>
<p>配置中使用bean标签autowire属性设置自动装配的类型</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;bookDao&#34;</span> <span class="na">class=</span><span class="s">&#34;com.itghd.dao.impl.BookDaoImpl&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;bookService&#34;</span> <span class="na">class=</span><span class="s">&#34;com.itghd.service.impl.BookServiceImpl&#34;</span> <span class="na">autowire=</span><span class="s">&#34;byType&#34;</span><span class="nt">/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="依赖自动装配特征" class="headerLink">
    <a href="#%e4%be%9d%e8%b5%96%e8%87%aa%e5%8a%a8%e8%a3%85%e9%85%8d%e7%89%b9%e5%be%81" class="header-mark"></a>依赖自动装配特征</h5><ol>
<li>自动装配用于引用类型依赖注入，不能对简单类型进行操作</li>
<li>使用按类型装配时（byType）必须保障容器中相同类型的bean唯一，推荐使用</li>
<li>使用按名称装配时（byName）必须保障容器中具有指定名称的bean，因变量名与配置耦合，不推荐使用</li>
<li>自动装配优先级低于setter注入与构造器注入，同时出现时自动装配配置失效</li>
</ol>
<h3 id="3-集合注入" class="headerLink">
    <a href="#3-%e9%9b%86%e5%90%88%e6%b3%a8%e5%85%a5" class="header-mark"></a>3 集合注入</h3><h4 id="31-注入数组类型数据" class="headerLink">
    <a href="#31-%e6%b3%a8%e5%85%a5%e6%95%b0%e7%bb%84%e7%b1%bb%e5%9e%8b%e6%95%b0%e6%8d%ae" class="header-mark"></a>3.1 注入数组类型数据</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;array&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;array&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;value&gt;</span>100<span class="nt">&lt;/value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;value&gt;</span>200<span class="nt">&lt;/value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;value&gt;</span>300<span class="nt">&lt;/value&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/array&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="32-注入list类型数据" class="headerLink">
    <a href="#32-%e6%b3%a8%e5%85%a5list%e7%b1%bb%e5%9e%8b%e6%95%b0%e6%8d%ae" class="header-mark"></a>3.2 注入List类型数据</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;list&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;list&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;value&gt;</span>itcast<span class="nt">&lt;/value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;value&gt;</span>itghd<span class="nt">&lt;/value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;value&gt;</span>boxuegu<span class="nt">&lt;/value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;value&gt;</span>chuanzhihui<span class="nt">&lt;/value&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/list&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="33-注入set类型数据" class="headerLink">
    <a href="#33-%e6%b3%a8%e5%85%a5set%e7%b1%bb%e5%9e%8b%e6%95%b0%e6%8d%ae" class="header-mark"></a>3.3 注入Set类型数据</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;set&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;set&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;value&gt;</span>itcast<span class="nt">&lt;/value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;value&gt;</span>itghd<span class="nt">&lt;/value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;value&gt;</span>boxuegu<span class="nt">&lt;/value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;value&gt;</span>boxuegu<span class="nt">&lt;/value&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/set&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="34-注入map类型数据" class="headerLink">
    <a href="#34-%e6%b3%a8%e5%85%a5map%e7%b1%bb%e5%9e%8b%e6%95%b0%e6%8d%ae" class="header-mark"></a>3.4 注入Map类型数据</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;map&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;map&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&#34;country&#34;</span> <span class="na">value=</span><span class="s">&#34;china&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&#34;province&#34;</span> <span class="na">value=</span><span class="s">&#34;henan&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&#34;city&#34;</span> <span class="na">value=</span><span class="s">&#34;kaifeng&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/map&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="35-注入properties类型数据" class="headerLink">
    <a href="#35-%e6%b3%a8%e5%85%a5properties%e7%b1%bb%e5%9e%8b%e6%95%b0%e6%8d%ae" class="header-mark"></a>3.5 注入Properties类型数据</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;properties&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;props&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">&#34;country&#34;</span><span class="nt">&gt;</span>china<span class="nt">&lt;/prop&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">&#34;province&#34;</span><span class="nt">&gt;</span>henan<span class="nt">&lt;/prop&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">&#34;city&#34;</span><span class="nt">&gt;</span>kaifeng<span class="nt">&lt;/prop&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/props&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/property&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>说明：property标签表示setter方式注入，构造方式注入constructor-arg标签内部也可以写&lt;array&gt;、&lt;list&gt;、&lt;set&gt;、&lt;map&gt;、&lt;props&gt;标签</p>
</blockquote>
<ul>
<li><i class="far fa-square fa-fw"></i> </li>
</ul>
<h2 id="四第三方资源配置管理" class="headerLink">
    <a href="#%e5%9b%9b%e7%ac%ac%e4%b8%89%e6%96%b9%e8%b5%84%e6%ba%90%e9%85%8d%e7%bd%ae%e7%ae%a1%e7%90%86" class="header-mark"></a>四、第三方资源配置管理</h2><h3 id="1-管理datasource连接池对象" class="headerLink">
    <a href="#1-%e7%ae%a1%e7%90%86datasource%e8%bf%9e%e6%8e%a5%e6%b1%a0%e5%af%b9%e8%b1%a1" class="header-mark"></a>1 管理DataSource连接池对象</h3><h4 id="问题导入-9" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-9" class="header-mark"></a>问题导入</h4><p>配置数据库连接参数时，注入驱动类名是用driverClassName还是driver？</p>
<h4 id="11-管理druid连接池重点" class="headerLink">
    <a href="#11-%e7%ae%a1%e7%90%86druid%e8%bf%9e%e6%8e%a5%e6%b1%a0%e9%87%8d%e7%82%b9" class="header-mark"></a>1.1 管理Druid连接池【重点】</h4><p><strong>数据库准备</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="n">spring_db</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">utf8</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">use</span><span class="w"> </span><span class="n">spring_db</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="n">tbl_account</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="n">auto_increment</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">money</span><span class="w"> </span><span class="n">double</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">tbl_account</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="k">null</span><span class="p">,</span><span class="s1">&#39;Tom&#39;</span><span class="p">,</span><span class="mi">1000</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">tbl_account</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="k">null</span><span class="p">,</span><span class="s1">&#39;Jerry&#39;</span><span class="p">,</span><span class="mi">1000</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>【第一步】添加Druid连接池依赖</strong></p>
<p>jdk8</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>druid<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>1.1.16<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>5.1.47<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>jdk17</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;artifactId&gt;</span>druid<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;version&gt;</span>1.2.6<span class="nt">&lt;/version&gt;</span> <span class="c">&lt;!-- 使用最新的 Druid 版本 --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;version&gt;</span>8.0.27<span class="nt">&lt;/version&gt;</span> <span class="c">&lt;!-- 使用最新的 MySQL Connector 版本 --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：除了添加以上两个依赖之外，别忘了添加spring-context依赖。</p>
</blockquote>
<p><strong>【第二步】配置DruidDataSource连接池Bean对象</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">class=</span><span class="s">&#34;com.alibaba.druid.pool.DruidDataSource&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;driverClassName&#34;</span> <span class="na">value=</span><span class="s">&#34;com.mysql.jdbc.Driver&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;url&#34;</span> <span class="na">value=</span><span class="s">&#34;jdbc:mysql://localhost:3306/spring_db&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;username&#34;</span> <span class="na">value=</span><span class="s">&#34;root&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;password&#34;</span> <span class="na">value=</span><span class="s">&#34;root&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/bean&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>【第三步】在测试类中从IOC容器中获取连接池对象并打印</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">App</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClassPathXmlApplicationContext</span><span class="p">(</span><span class="s">&#34;applicationContext.xml&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">DataSource</span><span class="p">)</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&#34;dataSource&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">dataSource</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="12-管理c3p0连接池" class="headerLink">
    <a href="#12-%e7%ae%a1%e7%90%86c3p0%e8%bf%9e%e6%8e%a5%e6%b1%a0" class="header-mark"></a>1.2 管理c3p0连接池</h4><p><strong>【第一步】添加c3p0连接池依赖</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>c3p0<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>c3p0<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>0.9.1.2<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>【第二步】配置c3p0连接池Bean对象</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">class=</span><span class="s">&#34;com.mchange.v2.c3p0.ComboPooledDataSource&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;driverClass&#34;</span> <span class="na">value=</span><span class="s">&#34;com.mysql.jdbc.Driver&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;jdbcUrl&#34;</span> <span class="na">value=</span><span class="s">&#34;jdbc:mysql://localhost:3306/spring_db&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;user&#34;</span> <span class="na">value=</span><span class="s">&#34;root&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;password&#34;</span> <span class="na">value=</span><span class="s">&#34;root&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;maxPoolSize&#34;</span> <span class="na">value=</span><span class="s">&#34;1000&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/bean&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意：同一个Spring容器中不能有两个id=&ldquo;dataSource&quot;的连接池。</p>
</blockquote>
<p><strong>【第三步】在测试类中从IOC容器中获取连接池对象并打印</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">App</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClassPathXmlApplicationContext</span><span class="p">(</span><span class="s">&#34;applicationContext.xml&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">DataSource</span><span class="p">)</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&#34;dataSource&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">dataSource</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-加载properties属性文件重点" class="headerLink">
    <a href="#2-%e5%8a%a0%e8%bd%bdproperties%e5%b1%9e%e6%80%a7%e6%96%87%e4%bb%b6%e9%87%8d%e7%82%b9" class="header-mark"></a>2 加载properties属性文件【重点】</h3><blockquote>
<p>目的：将数据库的连接参数抽取到一个单独的文件中，与Spring配置文件解耦。</p>
</blockquote>
<h4 id="问题导入-10" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-10" class="header-mark"></a>问题导入</h4><p>问题1：如何解决使用EL表达式读取属性文件中的值结果读取到了系统属性问题？</p>
<p>问题2：加载properties文件写法标准写法该怎么写？</p>
<h4 id="21-基本用法" class="headerLink">
    <a href="#21-%e5%9f%ba%e6%9c%ac%e7%94%a8%e6%b3%95" class="header-mark"></a>2.1 基本用法</h4><p><strong>【第一步】编写jdbc.properties属性文件</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="na">jdbc.driver</span><span class="o">=</span><span class="s">com.mysql.jdbc.Driver</span>
</span></span><span class="line"><span class="cl"><span class="na">jdbc.url</span><span class="o">=</span><span class="s">jdbc:mysql://127.0.0.1:3306/spring_db</span>
</span></span><span class="line"><span class="cl"><span class="na">jdbc.username</span><span class="o">=</span><span class="s">root</span>
</span></span><span class="line"><span class="cl"><span class="na">jdbc.password</span><span class="o">=</span><span class="s">root</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>【第二步】在applicationContext.xml中开启开启context命名空间，加载jdbc.properties属性文件</strong></p>
<p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331019.png" title="image-20210730101826913" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331019.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331019.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331019.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331019.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331019.png 2x"
            sizes="auto"
            alt="image-20210730101826913">
    </a></figure></p>
<p><strong>==小技巧：如果同学们觉得上述复制粘贴方式不好改或者容易改错，其实idea是有提示功能的，注意不要选错就行了。有些版本的idea没有这个提示，那么就按照上面复制粘贴的方式改，改完之后可以做成live template模板，后期直接用。==</strong></p>
<p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331069.png" title="image-20210730102053281" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331069.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331069.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331069.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331069.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331069.png 2x"
            sizes="auto"
            alt="image-20210730102053281">
    </a></figure></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">&#34;jdbc.properties&#34;</span><span class="nt">/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>【第三步】在配置连接池Bean的地方使用EL表达式获取jdbc.properties属性文件中的值</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;com.alibaba.druid.pool.DruidDataSource&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;driverClassName&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.driver}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;url&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.url}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;username&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.username}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;password&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.password}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/bean&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>配置完成之后，运行之前的获取Druid连接池代码，可以获取到连接池对象就表示配置成功。</p>
</blockquote>
<h4 id="22-配置不加载系统属性" class="headerLink">
    <a href="#22-%e9%85%8d%e7%bd%ae%e4%b8%8d%e5%8a%a0%e8%bd%bd%e7%b3%bb%e7%bb%9f%e5%b1%9e%e6%80%a7" class="header-mark"></a>2.2 配置不加载系统属性</h4><p><strong>问题</strong></p>
<p>如果属性文件中配置的不是jdbc.username，而是username=root666，那么使用${username}获取到的不是root666，而是计算机的名称。</p>
<p><strong>原因</strong></p>
<p>系统属性的优先级比我们属性文件中的高，替换了我们的username=root666。</p>
<p><strong>解决</strong></p>
<p>解决1：换一个名称，例如不叫username，叫jdbc.username。</p>
<p>解决2：使用system-properties-mode=&ldquo;NEVER&quot;属性表示不使用系统属性。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="na">&lt;context</span><span class="o">:</span><span class="s">property-placeholder location=&#34;jdbc.properties&#34; system-properties-mode=&#34;NEVER&#34;/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="23-加载properties文件写法" class="headerLink">
    <a href="#23-%e5%8a%a0%e8%bd%bdproperties%e6%96%87%e4%bb%b6%e5%86%99%e6%b3%95" class="header-mark"></a>2.3 加载properties文件写法</h4><ul>
<li>不加载系统属性</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">&#34;jdbc.properties&#34;</span> <span class="na">system-properties-mode=</span><span class="s">&#34;NEVER&#34;</span><span class="nt">/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>加载多个properties文件</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">&#34;jdbc.properties,msg.properties&#34;</span><span class="nt">/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>加载所有properties文件</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">&#34;*.properties&#34;</span><span class="nt">/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>加载properties文件**==标准格式==**</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">&#34;classpath:*.properties&#34;</span><span class="nt">/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>加载properties文件标准格式</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">&#34;classpath*:*.properties&#34;</span><span class="nt">/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="五spring容器" class="headerLink">
    <a href="#%e4%ba%94spring%e5%ae%b9%e5%99%a8" class="header-mark"></a>五、Spring容器</h2><h3 id="1-spring核心容器介绍" class="headerLink">
    <a href="#1-spring%e6%a0%b8%e5%bf%83%e5%ae%b9%e5%99%a8%e4%bb%8b%e7%bb%8d" class="header-mark"></a>1 Spring核心容器介绍</h3><h4 id="问题导入-11" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-11" class="header-mark"></a>问题导入</h4><p>问题：按照Bean名称获取Bean有什么弊端，按照Bean类型获取Bean有什么弊端？</p>
<h4 id="11-创建容器" class="headerLink">
    <a href="#11-%e5%88%9b%e5%bb%ba%e5%ae%b9%e5%99%a8" class="header-mark"></a>1.1 创建容器</h4><ul>
<li>方式一：类路径加载配置文件</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClassPathXmlApplicationContext</span><span class="p">(</span><span class="s">&#34;applicationContext.xml&#34;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>方式二：文件路径加载配置文件</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileSystemXmlApplicationContext</span><span class="p">(</span><span class="s">&#34;D:\\applicationContext.xml&#34;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>加载多个配置文件</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClassPathXmlApplicationContext</span><span class="p">(</span><span class="s">&#34;bean1.xml&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;bean2.xml&#34;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="12-获取bean对象" class="headerLink">
    <a href="#12-%e8%8e%b7%e5%8f%96bean%e5%af%b9%e8%b1%a1" class="header-mark"></a>1.2 获取bean对象</h4><ul>
<li>方式一：使用bean名称获取</li>
</ul>
<blockquote>
<p>弊端：需要自己强制类型转换</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BookDao</span><span class="p">)</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&#34;bookDao&#34;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>==方式二：使用bean名称获取并指定类型==</strong></li>
</ul>
<blockquote>
<p>弊端：推荐使用</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&#34;bookDao&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">BookDao</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>方式三：使用bean类型获取</li>
</ul>
<blockquote>
<p>弊端：如果IOC容器中同类型的Bean对象有多个，此处获取会报错</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">BookDao</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="13-容器类层次结构" class="headerLink">
    <a href="#13-%e5%ae%b9%e5%99%a8%e7%b1%bb%e5%b1%82%e6%ac%a1%e7%bb%93%e6%9e%84" class="header-mark"></a>1.3 容器类层次结构</h4><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331300.png" title="image-20210730102842030" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331300.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331300.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331300.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331300.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331300.png 2x"
            sizes="auto"
            alt="image-20210730102842030">
    </a></figure></p>
<h4 id="14-beanfactory" class="headerLink">
    <a href="#14-beanfactory" class="header-mark"></a>1.4 BeanFactory</h4><ul>
<li>类路径加载配置文件</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Resource</span><span class="w"> </span><span class="n">resources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClassPathResource</span><span class="p">(</span><span class="s">&#34;applicationContext.xml&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">BeanFactory</span><span class="w"> </span><span class="n">bf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XmlBeanFactory</span><span class="p">(</span><span class="n">resources</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bf</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&#34;bookDao&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">BookDao</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">bookDao</span><span class="p">.</span><span class="na">save</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>BeanFactory创建完毕后，所有的Bean均为延迟加载，也就是说我们调用getBean()方法获取Bean对象时才创建Bean对象并返回给我们</li>
</ul>
<h3 id="2-spring核心容器总结" class="headerLink">
    <a href="#2-spring%e6%a0%b8%e5%bf%83%e5%ae%b9%e5%99%a8%e6%80%bb%e7%bb%93" class="header-mark"></a>2 Spring核心容器总结</h3><h4 id="21-容器相关" class="headerLink">
    <a href="#21-%e5%ae%b9%e5%99%a8%e7%9b%b8%e5%85%b3" class="header-mark"></a>2.1 容器相关</h4><ul>
<li>BeanFactory是IoC容器的顶层接口，初始化BeanFactory对象时，加载的bean延迟加载</li>
<li>ApplicationContext接口是Spring容器的核心接口，初始化时bean立即加载</li>
<li>ApplicationContext接口提供基础的bean操作相关方法，通过其他接口扩展其功能</li>
<li>ApplicationContext接口常用初始化类
<ul>
<li><strong>==ClassPathXmlApplicationContext(常用)==</strong></li>
<li>FileSystemXmlApplicationContext</li>
</ul>
</li>
</ul>
<h4 id="22-bean相关" class="headerLink">
    <a href="#22-bean%e7%9b%b8%e5%85%b3" class="header-mark"></a>2.2 bean相关</h4><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331180.png" title="image-20210730103438742" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331180.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331180.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331180.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331180.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331180.png 2x"
            sizes="auto"
            alt="image-20210730103438742">
    </a></figure></p>
<h4 id="23-依赖注入相关" class="headerLink">
    <a href="#23-%e4%be%9d%e8%b5%96%e6%b3%a8%e5%85%a5%e7%9b%b8%e5%85%b3" class="header-mark"></a>2.3 依赖注入相关</h4><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331269.png" title="image-20210730103701525" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331269.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331269.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331269.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331269.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331269.png 2x"
            sizes="auto"
            alt="image-20210730103701525">
    </a></figure></p>
<h2 id="六spring注解开发" class="headerLink">
    <a href="#%e5%85%adspring%e6%b3%a8%e8%a7%a3%e5%bc%80%e5%8f%91" class="header-mark"></a>六、Spring注解开发</h2><h3 id="1-注解开发定义bean对象重点" class="headerLink">
    <a href="#1-%e6%b3%a8%e8%a7%a3%e5%bc%80%e5%8f%91%e5%ae%9a%e4%b9%89bean%e5%af%b9%e8%b1%a1%e9%87%8d%e7%82%b9" class="header-mark"></a>1 注解开发定义Bean对象【重点】</h3><blockquote>
<p>目的：xml配置Bean对象有些繁琐，使用注解简化Bean对象的定义</p>
</blockquote>
<h4 id="问题导入-12" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-12" class="header-mark"></a>问题导入</h4><p>问题1：使用什么标签进行Spring注解包扫描？</p>
<p>问题2：@Component注解和@Controller、@Service、@Repository三个衍生注解有什么区别？</p>
<h4 id="11-基本使用" class="headerLink">
    <a href="#11-%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8" class="header-mark"></a>1.1 基本使用</h4><p><strong>【第一步】在applicationContext.xml中开启Spring注解包扫描</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xsi:schemaLocation=</span><span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
</span></span></span><span class="line"><span class="cl"><span class="s">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">	 <span class="c">&lt;!--扫描com.itghd包及其子包下的类中注解--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.itghd&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/beans&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>【第二步】在类上使用@Component注解定义Bean。</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//@Component定义bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Component</span><span class="p">(</span><span class="s">&#34;bookDao&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookDaoImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BookDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;book dao save ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BookService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setBookDao</span><span class="p">(</span><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">bookDao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bookDao</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;book service save ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">bookDao</span><span class="p">.</span><span class="na">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>补充说明：如果@Component注解没有使用参数指定Bean的名称，那么类名首字母小写就是Bean在IOC容器中的默认名称。例如：BookServiceImpl对象在IOC容器中的名称是bookServiceImpl。</p>
</blockquote>
<p><strong>【第三步】在测试类中获取Bean对象</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppForAnnotation</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClassPathXmlApplicationContext</span><span class="p">(</span><span class="s">&#34;applicationContext.xml&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BookDao</span><span class="p">)</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&#34;bookDao&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">bookDao</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//按类型获取bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">BookService</span><span class="w"> </span><span class="n">bookService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">BookService</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">bookService</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意：在测试类中不要调用bookService的save方法，因为还没有给BookServiceImpl中的bookDao赋值，调用bookService的save方法会出现空指针异常。</p>
</blockquote>
<p><strong>运行结果</strong></p>
<p><figure><a class="lightgallery" href="D:%5c%e6%96%b0%e5%bb%ba%e6%96%87%e4%bb%b6%e5%a4%b9%5c_posts%5cimage-20210730104835746.png" title="image-20210730104835746" data-thumbnail="D:\新建文件夹\_posts\image-20210730104835746.png">
        <img
            
            loading="lazy"
            src="D:%5c%e6%96%b0%e5%bb%ba%e6%96%87%e4%bb%b6%e5%a4%b9%5c_posts%5cimage-20210730104835746.png"
            srcset="D:%5c%e6%96%b0%e5%bb%ba%e6%96%87%e4%bb%b6%e5%a4%b9%5c_posts%5cimage-20210730104835746.png, D:%5c%e6%96%b0%e5%bb%ba%e6%96%87%e4%bb%b6%e5%a4%b9%5c_posts%5cimage-20210730104835746.png 1.5x, D:%5c%e6%96%b0%e5%bb%ba%e6%96%87%e4%bb%b6%e5%a4%b9%5c_posts%5cimage-20210730104835746.png 2x"
            sizes="auto"
            alt="image-20210730104835746">
    </a></figure></p>
<h4 id="12-component三个衍生注解" class="headerLink">
    <a href="#12-component%e4%b8%89%e4%b8%aa%e8%a1%8d%e7%94%9f%e6%b3%a8%e8%a7%a3" class="header-mark"></a>1.2 @Component三个衍生注解</h4><blockquote>
<p>说明：加粗的注解为常用注解</p>
</blockquote>
<ul>
<li>Spring提供**<code>@Component</code>**注解的三个衍生注解
<ul>
<li><strong><code>@Controller</code></strong>：用于表现层bean定义</li>
<li><strong><code>@Service</code></strong>：用于业务层bean定义</li>
<li><code>@Repository</code>：用于数据层bean定义</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Repository</span><span class="p">(</span><span class="s">&#34;bookDao&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookDaoImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BookDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BookService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-纯注解开发模式重点" class="headerLink">
    <a href="#2-%e7%ba%af%e6%b3%a8%e8%a7%a3%e5%bc%80%e5%8f%91%e6%a8%a1%e5%bc%8f%e9%87%8d%e7%82%b9" class="header-mark"></a>2 纯注解开发模式【重点】</h3><h4 id="问题导入-13" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-13" class="header-mark"></a>问题导入</h4><p>问题1：配置类上使用什么注解表示该类是一个配置类？</p>
<p>问题2：配置类上使用什么注解进行Spring注解包扫描？</p>
<h4 id="21-纯注解开发模式介绍" class="headerLink">
    <a href="#21-%e7%ba%af%e6%b3%a8%e8%a7%a3%e5%bc%80%e5%8f%91%e6%a8%a1%e5%bc%8f%e4%bb%8b%e7%bb%8d" class="header-mark"></a>2.1 纯注解开发模式介绍</h4><ul>
<li>Spring3.0开启了纯注解开发模式，使用Java类替代配置文件，开启了Spring快速开发赛道</li>
<li>Java类代替Spring核心配置文件</li>
</ul>
<p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331527.png" title="image-20210803192052811" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331527.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331527.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331527.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331527.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331527.png 2x"
            sizes="auto"
            alt="image-20210803192052811">
    </a></figure></p>
<ul>
<li>@Configuration注解用于设定当前类为配置类</li>
<li>@ComponentScan注解用于设定扫描路径，此注解只能添加一次，多个数据请用数组格式</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@ComponentScan</span><span class="p">({</span><span class="n">com</span><span class="p">.</span><span class="na">itghd</span><span class="p">.</span><span class="na">service</span><span class="s">&#34;,&#34;</span><span class="n">com</span><span class="p">.</span><span class="na">itghd</span><span class="p">.</span><span class="na">dao</span><span class="s">&#34;})
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>读取Spring核心配置文件初始化容器对象切换为读取Java配置类初始化容器对象</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//加载配置文件初始化容器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClassPathXmlApplicationContext</span><span class="p">(</span><span class="s">&#34;applicationContext.xml&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//加载配置类初始化容器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">SpringConfig</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="22-代码演示" class="headerLink">
    <a href="#22-%e4%bb%a3%e7%a0%81%e6%bc%94%e7%a4%ba" class="header-mark"></a>2.2 代码演示</h4><p><strong>【第一步】定义配置类代替配置文件</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//声明当前类为Spring配置类</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//Spring注解扫描，相当于&lt;context:component-scan base-package=&#34;com.itghd&#34;/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@ComponentScan</span><span class="p">(</span><span class="s">&#34;com.itghd&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//设置bean扫描路径，多个路径书写为字符串数组格式</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//@ComponentScan({&#34;com.itghd.service&#34;,&#34;com.itghd.dao&#34;})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>【第二步】在测试类中加载配置类，获取Bean对象并使用</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppForAnnotation</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//AnnotationConfigApplicationContext加载Spring配置类初始化Spring容器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">SpringConfig</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BookDao</span><span class="p">)</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&#34;bookDao&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">bookDao</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//按类型获取bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">BookService</span><span class="w"> </span><span class="n">bookService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">BookService</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">bookService</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-注解开发bean作用范围和生命周期管理" class="headerLink">
    <a href="#3-%e6%b3%a8%e8%a7%a3%e5%bc%80%e5%8f%91bean%e4%bd%9c%e7%94%a8%e8%8c%83%e5%9b%b4%e5%92%8c%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e7%ae%a1%e7%90%86" class="header-mark"></a>3 注解开发Bean作用范围和生命周期管理</h3><h4 id="问题导入-14" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-14" class="header-mark"></a>问题导入</h4><p>在类上使用什么注解定义Bean的作用范围？</p>
<h4 id="31-bean作用范围注解配置" class="headerLink">
    <a href="#31-bean%e4%bd%9c%e7%94%a8%e8%8c%83%e5%9b%b4%e6%b3%a8%e8%a7%a3%e9%85%8d%e7%bd%ae" class="header-mark"></a>3.1 bean作用范围注解配置</h4><ul>
<li>使用@Scope定义bean作用范围</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Repository</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Scope</span><span class="p">(</span><span class="s">&#34;singleton&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookDaoImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BookDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="32-bean生命周期注解配置" class="headerLink">
    <a href="#32-bean%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e6%b3%a8%e8%a7%a3%e9%85%8d%e7%bd%ae" class="header-mark"></a>3.2 bean生命周期注解配置</h4><ul>
<li>使用@PostConstruct、@PreDestroy定义bean生命周期</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Repository</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Scope</span><span class="p">(</span><span class="s">&#34;singleton&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookDaoImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BookDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">BookDaoImpl</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;book dao constructor ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@PostConstruct</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;book init ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@PreDestroy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">destroy</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;book destory ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>==<strong>注意：@PostConstruct和@PreDestroy注解是jdk中提供的注解，从jdk9开始，jdk中的javax.annotation包被移除了，也就是说这两个注解就用不了了，可以额外导入一下依赖解决这个问题。</strong>==</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>javax.annotation<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>javax.annotation-api<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>1.3.2<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-注解开发依赖注入重点" class="headerLink">
    <a href="#4-%e6%b3%a8%e8%a7%a3%e5%bc%80%e5%8f%91%e4%be%9d%e8%b5%96%e6%b3%a8%e5%85%a5%e9%87%8d%e7%82%b9" class="header-mark"></a>4 注解开发依赖注入【重点】</h3><h4 id="问题导入-15" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-15" class="header-mark"></a>问题导入</h4><p>问题1：请描述@Autowired注解是如何进行自动装配的？</p>
<p>问题2：请描述@Qualifier注解的作用</p>
<h4 id="41-使用autowired注解开启自动装配模式按类型" class="headerLink">
    <a href="#41-%e4%bd%bf%e7%94%a8autowired%e6%b3%a8%e8%a7%a3%e5%bc%80%e5%90%af%e8%87%aa%e5%8a%a8%e8%a3%85%e9%85%8d%e6%a8%a1%e5%bc%8f%e6%8c%89%e7%b1%bb%e5%9e%8b" class="header-mark"></a>4.1 使用@Autowired注解开启自动装配模式（按类型）</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BookService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//@Autowired：注入引用类型，自动装配模式，默认按类型装配</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;book service save ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">bookDao</span><span class="p">.</span><span class="na">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>说明：不管是使用配置文件还是配置类，都必须进行对应的Spring注解包扫描才可以使用。@Autowired默认按照类型自动装配，如果IOC容器中同类的Bean有多个，那么默认按照变量名和Bean的名称匹配，建议使用@Qualifier注解指定要装配的bean名称</p>
</blockquote>
<p>==注意：自动装配基于反射设计创建对象并暴力反射对应属性为私有属性初始化数据，因此无需提供setter方法。==</p>
<h4 id="42-使用qualifier注解指定要装配的bean名称" class="headerLink">
    <a href="#42-%e4%bd%bf%e7%94%a8qualifier%e6%b3%a8%e8%a7%a3%e6%8c%87%e5%ae%9a%e8%a6%81%e8%a3%85%e9%85%8d%e7%9a%84bean%e5%90%8d%e7%a7%b0" class="header-mark"></a>4.2 使用@Qualifier注解指定要装配的bean名称</h4><blockquote>
<p>目的：解决IOC容器中同类型Bean有多个装配哪一个的问题</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BookService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//@Autowired：注入引用类型，自动装配模式，默认按类型装配</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//@Qualifier：自动装配bean时按bean名称装配</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&#34;bookDao&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;book service save ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">bookDao</span><span class="p">.</span><span class="na">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>==注意：@Qualifier注解无法单独使用，必须配合@Autowired注解使用==</p>
<h4 id="43-使用value实现简单类型注入" class="headerLink">
    <a href="#43-%e4%bd%bf%e7%94%a8value%e5%ae%9e%e7%8e%b0%e7%ae%80%e5%8d%95%e7%b1%bb%e5%9e%8b%e6%b3%a8%e5%85%a5" class="header-mark"></a>4.3 使用@Value实现简单类型注入</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Repository</span><span class="p">(</span><span class="s">&#34;bookDao&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookDaoImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BookDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//@Value：注入简单类型（无需提供set方法）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;${name}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;book dao save ...&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>以上@Value注解中使用${name}从属性文件中读取name值，那么就需要在配置类或者配置文件中加载属性文件。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@ComponentScan</span><span class="p">(</span><span class="s">&#34;com.itghd&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//@PropertySource加载properties配置文件</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@PropertySource</span><span class="p">({</span><span class="s">&#34;classpath:jdbc.properties&#34;</span><span class="p">})</span><span class="w"> </span><span class="c1">//{}可以省略不写</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>==注意：@PropertySource()中加载多文件请使用数组格式配置，不允许使用通配符*==</p>
<h3 id="5-注解开发管理第三方bean重点" class="headerLink">
    <a href="#5-%e6%b3%a8%e8%a7%a3%e5%bc%80%e5%8f%91%e7%ae%a1%e7%90%86%e7%ac%ac%e4%b8%89%e6%96%b9bean%e9%87%8d%e7%82%b9" class="header-mark"></a>5 注解开发管理第三方Bean【重点】</h3><h4 id="问题导入-16" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-16" class="header-mark"></a>问题导入</h4><p>导入自己定义的配置类有几种方式？</p>
<h4 id="第一步单独定义配置类" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%80%e6%ad%a5%e5%8d%95%e7%8b%ac%e5%ae%9a%e4%b9%89%e9%85%8d%e7%bd%ae%e7%b1%bb" class="header-mark"></a><strong>【第一步】单独定义配置类</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JdbcConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//@Bean：表示当前方法的返回值是一个bean对象，添加到IOC容器中</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">DataSource</span><span class="w"> </span><span class="nf">dataSource</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">DruidDataSource</span><span class="w"> </span><span class="n">ds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DruidDataSource</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ds</span><span class="p">.</span><span class="na">setDriverClassName</span><span class="p">(</span><span class="s">&#34;com.mysql.jdbc.Driver&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ds</span><span class="p">.</span><span class="na">setUrl</span><span class="p">(</span><span class="s">&#34;jdbc:mysql://localhost:3306/spring_db&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ds</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="s">&#34;root&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ds</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="s">&#34;root&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ds</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="第二步将独立的配置类加入核心配置" class="headerLink">
    <a href="#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e5%b0%86%e7%8b%ac%e7%ab%8b%e7%9a%84%e9%85%8d%e7%bd%ae%e7%b1%bb%e5%8a%a0%e5%85%a5%e6%a0%b8%e5%bf%83%e9%85%8d%e7%bd%ae" class="header-mark"></a><strong>【第二步】将独立的配置类加入核心配置</strong></h4><h5 id="方式1import注解导入式" class="headerLink">
    <a href="#%e6%96%b9%e5%bc%8f1import%e6%b3%a8%e8%a7%a3%e5%af%bc%e5%85%a5%e5%bc%8f" class="header-mark"></a>方式1：@Import注解导入式</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@ComponentScan</span><span class="p">(</span><span class="s">&#34;com.itghd&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//@Import:导入配置信息</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Import</span><span class="p">({</span><span class="n">JdbcConfig</span><span class="p">.</span><span class="na">class</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="方式2componentscan扫描式" class="headerLink">
    <a href="#%e6%96%b9%e5%bc%8f2componentscan%e6%89%ab%e6%8f%8f%e5%bc%8f" class="header-mark"></a>方式2：@ComponentScan扫描式</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@ComponentScan</span><span class="p">({</span><span class="s">&#34;com.itghd.config&#34;</span><span class="p">,</span><span class="s">&#34;com.itghd.service&#34;</span><span class="p">,</span><span class="s">&#34;com.itghd.dao&#34;</span><span class="p">})</span><span class="w">  </span><span class="c1">//只要com.itghd.config包扫到了就行，三个包可以合并写成com.itghd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="6-注解开发为第三方bean注入资源重点" class="headerLink">
    <a href="#6-%e6%b3%a8%e8%a7%a3%e5%bc%80%e5%8f%91%e4%b8%ba%e7%ac%ac%e4%b8%89%e6%96%b9bean%e6%b3%a8%e5%85%a5%e8%b5%84%e6%ba%90%e9%87%8d%e7%82%b9" class="header-mark"></a>6 注解开发为第三方Bean注入资源【重点】</h3><h4 id="问题导入-17" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-17" class="header-mark"></a>问题导入</h4><p>配置类中如何注入简单类型数据，如何注入引用类型数据？</p>
<h4 id="61-简单类型依赖注入" class="headerLink">
    <a href="#61-%e7%ae%80%e5%8d%95%e7%b1%bb%e5%9e%8b%e4%be%9d%e8%b5%96%e6%b3%a8%e5%85%a5" class="header-mark"></a>6.1 简单类型依赖注入</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JdbcConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//1.定义一个方法获得要管理的对象</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;com.mysql.jdbc.Driver&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">driver</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;jdbc:mysql://localhost:3306/spring_db&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;root&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userName</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;root&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//2.@Bean：表示当前方法的返回值是一个bean对象，添加到IOC容器中</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">DataSource</span><span class="w"> </span><span class="nf">dataSource</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">DruidDataSource</span><span class="w"> </span><span class="n">ds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DruidDataSource</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ds</span><span class="p">.</span><span class="na">setDriverClassName</span><span class="p">(</span><span class="n">driver</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ds</span><span class="p">.</span><span class="na">setUrl</span><span class="p">(</span><span class="n">url</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ds</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="n">userName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ds</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="n">password</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ds</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>说明：如果@Value()中使用了EL表达式读取properties属性文件中的内容，那么就需要加载properties属性文件。</p>
</blockquote>
<h4 id="62-引用类型依赖注入" class="headerLink">
    <a href="#62-%e5%bc%95%e7%94%a8%e7%b1%bb%e5%9e%8b%e4%be%9d%e8%b5%96%e6%b3%a8%e5%85%a5" class="header-mark"></a>6.2 引用类型依赖注入</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//Spring会自动从IOC容器中找到BookDao对象赋值给参数bookDao变量，如果没有就会报错。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Bean</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">DataSource</span><span class="w"> </span><span class="nf">dataSource</span><span class="p">(</span><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">bookDao</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DruidDataSource</span><span class="w"> </span><span class="n">ds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DruidDataSource</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ds</span><span class="p">.</span><span class="na">setDriverClassName</span><span class="p">(</span><span class="n">driver</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ds</span><span class="p">.</span><span class="na">setUrl</span><span class="p">(</span><span class="n">url</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ds</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="n">userName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ds</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="n">password</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ds</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>说明：引用类型注入只需要为bean定义方法设置形参即可，容器会根据类型自动装配对象</p>
</blockquote>
<h3 id="7-注解开发总结" class="headerLink">
    <a href="#7-%e6%b3%a8%e8%a7%a3%e5%bc%80%e5%8f%91%e6%80%bb%e7%bb%93" class="header-mark"></a>7 注解开发总结</h3><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331578.png" title="image-20210730113548708" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331578.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331578.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331578.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331578.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331578.png 2x"
            sizes="auto"
            alt="image-20210730113548708">
    </a></figure></p>
<h2 id="七spring整合其他技术重点" class="headerLink">
    <a href="#%e4%b8%83spring%e6%95%b4%e5%90%88%e5%85%b6%e4%bb%96%e6%8a%80%e6%9c%af%e9%87%8d%e7%82%b9" class="header-mark"></a>七、Spring整合其他技术【重点】</h2><h3 id="1-spring整合mybatis重点" class="headerLink">
    <a href="#1-spring%e6%95%b4%e5%90%88mybatis%e9%87%8d%e7%82%b9" class="header-mark"></a>1 Spring整合mybatis【重点】</h3><h4 id="11-思路分析" class="headerLink">
    <a href="#11-%e6%80%9d%e8%b7%af%e5%88%86%e6%9e%90" class="header-mark"></a>1.1 思路分析</h4><h5 id="问题导入-18" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-18" class="header-mark"></a>问题导入</h5><p>mybatis进行数据层操作的核心对象是谁？</p>
<h5 id="111-mybatis程序核心对象分析" class="headerLink">
    <a href="#111-mybatis%e7%a8%8b%e5%ba%8f%e6%a0%b8%e5%bf%83%e5%af%b9%e8%b1%a1%e5%88%86%e6%9e%90" class="header-mark"></a>1.1.1 MyBatis程序核心对象分析</h5><p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331620.png" title="image-20210730114303147" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331620.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331620.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331620.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331620.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331620.png 2x"
            sizes="auto"
            alt="image-20210730114303147">
    </a></figure></p>
<h5 id="112-整合mybatis" class="headerLink">
    <a href="#112-%e6%95%b4%e5%90%88mybatis" class="header-mark"></a>1.1.2 整合MyBatis</h5><ul>
<li>使用SqlSessionFactoryBean封装SqlSessionFactory需要的环境信息</li>
</ul>
<p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331782.png" title="image-20210730114342060" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331782.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331782.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331782.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331782.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331782.png 2x"
            sizes="auto"
            alt="image-20210730114342060">
    </a></figure></p>
<ul>
<li>使用MapperScannerConfigurer加载Dao接口，创建代理对象保存到IOC容器中</li>
</ul>
<p><figure><a class="lightgallery" href="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331848.png" title="image-20210730114356175" data-thumbnail="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331848.png">
        <img
            
            loading="lazy"
            src="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331848.png"
            srcset="https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331848.png, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331848.png 1.5x, https://alphaguo-1322521250.cos.ap-beijing.myqcloud.com/202312312331848.png 2x"
            sizes="auto"
            alt="image-20210730114356175">
    </a></figure></p>
<h4 id="12-代码实现" class="headerLink">
    <a href="#12-%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0" class="header-mark"></a>1.2 代码实现</h4><h5 id="问题导入-19" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-19" class="header-mark"></a>问题导入</h5><p>问题1：Spring整合mybatis的依赖叫什么？</p>
<p>问题2：Spring整合mybatis需要管理配置哪两个Bean，这两个Bean作用分别是什么？</p>
<h5 id="前置工作" class="headerLink">
    <a href="#%e5%89%8d%e7%bd%ae%e5%b7%a5%e4%bd%9c" class="header-mark"></a>【前置工作】</h5><ol>
<li>在pom.xml中添加spring-context、druid、mybatis、mysql-connector-java等基础依赖。</li>
<li>准备service和dao层基础代码</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">AccountService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">Account</span><span class="w"> </span><span class="n">account</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">Account</span><span class="w"> </span><span class="n">account</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Account</span><span class="w"> </span><span class="nf">findById</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AccountServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">AccountService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AccountDao</span><span class="w"> </span><span class="n">accountDao</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">Account</span><span class="w"> </span><span class="n">account</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">accountDao</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">account</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">Account</span><span class="w"> </span><span class="n">account</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">accountDao</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">account</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">accountDao</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Account</span><span class="w"> </span><span class="nf">findById</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">accountDao</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">accountDao</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">AccountDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Insert</span><span class="p">(</span><span class="s">&#34;insert into tbl_account(name,money)values(#{name},#{money})&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">Account</span><span class="w"> </span><span class="n">account</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Delete</span><span class="p">(</span><span class="s">&#34;delete from tbl_account where id = #{id} &#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Update</span><span class="p">(</span><span class="s">&#34;update tbl_account set name = #{name} , money = #{money} where id = #{id} &#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">Account</span><span class="w"> </span><span class="n">account</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Select</span><span class="p">(</span><span class="s">&#34;select * from tbl_account&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Select</span><span class="p">(</span><span class="s">&#34;select * from tbl_account where id = #{id} &#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Account</span><span class="w"> </span><span class="nf">findById</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="第一步导入spring整合mybatis依赖java17" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%80%e6%ad%a5%e5%af%bc%e5%85%a5spring%e6%95%b4%e5%90%88mybatis%e4%be%9d%e8%b5%96java17" class="header-mark"></a><strong>【第一步】导入Spring整合Mybatis依赖</strong>(JAVA17)</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"> <span class="c">&lt;!-- Spring JDBC --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-jdbc<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;version&gt;</span>5.3.10<span class="nt">&lt;/version&gt;</span> 
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- MyBatis Spring --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.mybatis<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>mybatis-spring<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;version&gt;</span>2.0.7<span class="nt">&lt;/version&gt;</span> 
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="第二步创建jdbcconfig配置datasource数据源" class="headerLink">
    <a href="#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e5%88%9b%e5%bb%bajdbcconfig%e9%85%8d%e7%bd%aedatasource%e6%95%b0%e6%8d%ae%e6%ba%90" class="header-mark"></a><strong>【第二步】创建JdbcConfig配置DataSource数据源</strong></h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="na">jdbc.driver</span><span class="o">=</span><span class="s">com.mysql.jdbc.Driver</span>
</span></span><span class="line"><span class="cl"><span class="na">jdbc.url</span><span class="o">=</span><span class="s">jdbc:mysql://localhost:3306/spring_db?useSSL=false</span>
</span></span><span class="line"><span class="cl"><span class="na">jdbc.username</span><span class="o">=</span><span class="s">root</span>
</span></span><span class="line"><span class="cl"><span class="na">jdbc.password</span><span class="o">=</span><span class="s">root</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JdbcConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;${jdbc.driver}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">driver</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;${jdbc.url}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;${jdbc.username}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userName</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;${jdbc.password}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">DataSource</span><span class="w"> </span><span class="nf">dataSource</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">DruidDataSource</span><span class="w"> </span><span class="n">ds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DruidDataSource</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ds</span><span class="p">.</span><span class="na">setDriverClassName</span><span class="p">(</span><span class="n">driver</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ds</span><span class="p">.</span><span class="na">setUrl</span><span class="p">(</span><span class="n">url</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ds</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="n">userName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ds</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="n">password</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ds</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="第三步创建mybatisconfig整合mybatis" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%89%e6%ad%a5%e5%88%9b%e5%bb%bamybatisconfig%e6%95%b4%e5%90%88mybatis" class="header-mark"></a><strong>【第三步】创建MybatisConfig整合mybatis</strong></h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MybatisConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//定义bean，SqlSessionFactoryBean，用于产生SqlSessionFactory对象</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SqlSessionFactoryBean</span><span class="w"> </span><span class="nf">sqlSessionFactory</span><span class="p">(</span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SqlSessionFactoryBean</span><span class="w"> </span><span class="n">ssfb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlSessionFactoryBean</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ssfb</span><span class="p">.</span><span class="na">setTypeAliasesPackage</span><span class="p">(</span><span class="s">&#34;com.itghd.domain&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ssfb</span><span class="p">.</span><span class="na">setDataSource</span><span class="p">(</span><span class="n">dataSource</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ssfb</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//定义bean，返回MapperScannerConfigurer对象</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">MapperScannerConfigurer</span><span class="w"> </span><span class="nf">mapperScannerConfigurer</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">MapperScannerConfigurer</span><span class="w"> </span><span class="n">msc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MapperScannerConfigurer</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">msc</span><span class="p">.</span><span class="na">setBasePackage</span><span class="p">(</span><span class="s">&#34;com.itghd.dao&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">msc</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="第四步创建springconfig主配置类进行包扫描和加载其他配置类" class="headerLink">
    <a href="#%e7%ac%ac%e5%9b%9b%e6%ad%a5%e5%88%9b%e5%bb%baspringconfig%e4%b8%bb%e9%85%8d%e7%bd%ae%e7%b1%bb%e8%bf%9b%e8%a1%8c%e5%8c%85%e6%89%ab%e6%8f%8f%e5%92%8c%e5%8a%a0%e8%bd%bd%e5%85%b6%e4%bb%96%e9%85%8d%e7%bd%ae%e7%b1%bb" class="header-mark"></a><strong>【第四步】创建SpringConfig主配置类进行包扫描和加载其他配置类</strong></h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@ComponentScan</span><span class="p">(</span><span class="s">&#34;com.itghd&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//@PropertySource：加载类路径jdbc.properties文件</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@PropertySource</span><span class="p">(</span><span class="s">&#34;classpath:jdbc.properties&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Import</span><span class="p">({</span><span class="n">JdbcConfig</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="n">MybatisConfig</span><span class="p">.</span><span class="na">class</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="第五步定义测试类进行测试" class="headerLink">
    <a href="#%e7%ac%ac%e4%ba%94%e6%ad%a5%e5%ae%9a%e4%b9%89%e6%b5%8b%e8%af%95%e7%b1%bb%e8%bf%9b%e8%a1%8c%e6%b5%8b%e8%af%95" class="header-mark"></a><strong>【第五步】定义测试类进行测试</strong></h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">App</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">SpringConfig</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">AccountService</span><span class="w"> </span><span class="n">accountService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">AccountService</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Account</span><span class="w"> </span><span class="n">ac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accountService</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">ac</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-spring整合junit单元测试重点" class="headerLink">
    <a href="#2-spring%e6%95%b4%e5%90%88junit%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95%e9%87%8d%e7%82%b9" class="header-mark"></a>2 Spring整合Junit单元测试【重点】</h3><h4 id="问题导入-20" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-20" class="header-mark"></a>问题导入</h4><p>Spring整合Junit的两个注解作用分别是什么？</p>
<h4 id="第一步导入整合的依赖坐标spring-test" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%80%e6%ad%a5%e5%af%bc%e5%85%a5%e6%95%b4%e5%90%88%e7%9a%84%e4%be%9d%e8%b5%96%e5%9d%90%e6%a0%87spring-test" class="header-mark"></a>【第一步】导入整合的依赖坐标spring-test</h4><p>jdk8</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--junit--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>4.12<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--spring整合junit--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>spring-test<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>5.1.9.RELEASE<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>jdk17</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>org.junit.jupiter<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>junit-jupiter-engine<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>5.8.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- Spring 整合 JUnit 5 --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>spring-test<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>5.3.10<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="第二步使用spring整合junit专用的类加载器" class="headerLink">
    <a href="#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e4%bd%bf%e7%94%a8spring%e6%95%b4%e5%90%88junit%e4%b8%93%e7%94%a8%e7%9a%84%e7%b1%bb%e5%8a%a0%e8%bd%bd%e5%99%a8" class="header-mark"></a>【第二步】使用Spring整合Junit专用的类加载器</h4><h4 id="第三步加载配置文件或者配置类" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%89%e6%ad%a5%e5%8a%a0%e8%bd%bd%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e6%88%96%e8%80%85%e9%85%8d%e7%bd%ae%e7%b1%bb" class="header-mark"></a>【第三步】加载配置文件或者配置类</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//【第二步】使用Spring整合Junit专用的类加载器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//【第三步】加载配置文件或者配置类</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@ContextConfiguration</span><span class="p">(</span><span class="n">classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">SpringConfiguration</span><span class="p">.</span><span class="na">class</span><span class="p">})</span><span class="w"> </span><span class="c1">//加载配置类</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//@ContextConfiguration(locations={&#34;classpath:applicationContext.xml&#34;})//加载配置文件</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AccountServiceTest</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//支持自动装配注入bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AccountService</span><span class="w"> </span><span class="n">accountService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testFindById</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">accountService</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">1</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testFindAll</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">accountService</span><span class="p">.</span><span class="na">findAll</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="八aop" class="headerLink">
    <a href="#%e5%85%abaop" class="header-mark"></a>八、AOP</h2><h3 id="1-aop简介" class="headerLink">
    <a href="#1-aop%e7%ae%80%e4%bb%8b" class="header-mark"></a>1 AOP简介</h3><h4 id="问题导入-21" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-21" class="header-mark"></a>问题导入</h4><p>问题1：AOP的作用是什么？</p>
<p>问题2：连接点和切入点有什么区别，二者谁的范围大？</p>
<p>问题3：请描述什么是切面？</p>
<h4 id="11-aop简介和作用理解" class="headerLink">
    <a href="#11-aop%e7%ae%80%e4%bb%8b%e5%92%8c%e4%bd%9c%e7%94%a8%e7%90%86%e8%a7%a3" class="header-mark"></a>1.1 AOP简介和作用【理解】</h4><ul>
<li>AOP(Aspect Oriented Programming)面向切面编程，一种编程范式，指导开发者如何组织程序结构
<ul>
<li>OOP(Object Oriented Programming)面向对象编程</li>
</ul>
</li>
<li>作用：在不惊动原始设计的基础上为其进行功能增强。简单的说就是在不改变方法源代码的基础上对方法进行功能增强。</li>
<li>Spring理念：无入侵式/无侵入式</li>
</ul>
<h4 id="12-aop中的核心概念理解" class="headerLink">
    <a href="#12-aop%e4%b8%ad%e7%9a%84%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5%e7%90%86%e8%a7%a3" class="header-mark"></a>1.2 AOP中的核心概念【理解】</h4><p><figure><a class="lightgallery" href="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730144903209.png" title="image-20210730144903209" data-thumbnail="D:\AlphaGuoBlog\quark01\assets\image-20210730144903209.png">
        <img
            
            loading="lazy"
            src="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730144903209.png"
            srcset="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730144903209.png, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730144903209.png 1.5x, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730144903209.png 2x"
            sizes="auto"
            alt="image-20210730144903209">
    </a></figure></p>
<ul>
<li>连接点（JoinPoint）：正在执行的方法，例如：update()、delete()、select()等都是连接点。</li>
<li>切入点（Pointcut）：进行功能增强了的方法，例如:update()、delete()方法，select()方法没有被增强所以不是切入点，但是是连接点。
<ul>
<li>在SpringAOP中，一个切入点可以只描述一个具体方法，也可以匹配多个方法
<ul>
<li>一个具体方法：com.itheima.dao包下的BookDao接口中的无形参无返回值的save方法</li>
<li>匹配多个方法：所有的save方法，所有的get开头的方法，所有以Dao结尾的接口中的任意方法，所有带有一个参数的方法</li>
</ul>
</li>
</ul>
</li>
<li>通知（Advice）：在切入点前后执行的操作，也就是增强的共性功能
<ul>
<li>在SpringAOP中，功能最终以方法的形式呈现</li>
</ul>
</li>
<li>通知类：通知方法所在的类叫做通知类</li>
<li>切面（Aspect）：描述通知与切入点的对应关系，也就是哪些通知方法对应哪些切入点方法。</li>
</ul>
<h3 id="2-aop入门案例重点" class="headerLink">
    <a href="#2-aop%e5%85%a5%e9%97%a8%e6%a1%88%e4%be%8b%e9%87%8d%e7%82%b9" class="header-mark"></a>2 AOP入门案例【重点】</h3><h4 id="问题导入-22" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-22" class="header-mark"></a>问题导入</h4><p>问题1：在通知方法中如何定义切入点表达式？</p>
<p>问题2：如何配置切面？</p>
<p>问题3：在配置类上如何开启AOP注解功能？</p>
<h4 id="21-aop入门案例思路分析" class="headerLink">
    <a href="#21-aop%e5%85%a5%e9%97%a8%e6%a1%88%e4%be%8b%e6%80%9d%e8%b7%af%e5%88%86%e6%9e%90" class="header-mark"></a>2.1 AOP入门案例思路分析</h4><ul>
<li>案例设定：测定接口执行效率</li>
<li>简化设定：在接口执行前输出当前系统时间</li>
<li>开发模式：XML or <strong>==注解==</strong></li>
<li>思路分析：
<ol>
<li>导入坐标（pom.xml）</li>
<li>制作连接点方法（原始操作，dao接口与实现类）</li>
<li>制作共性功能（通知类与通知）</li>
<li>定义切入点</li>
<li>绑定切入点与通知关系（切面）</li>
</ol>
</li>
</ul>
<h4 id="22-aop入门案例实现" class="headerLink">
    <a href="#22-aop%e5%85%a5%e9%97%a8%e6%a1%88%e4%be%8b%e5%ae%9e%e7%8e%b0" class="header-mark"></a>2.2 AOP入门案例实现</h4><h5 id="第一步导入aop相关坐标" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%80%e6%ad%a5%e5%af%bc%e5%85%a5aop%e7%9b%b8%e5%85%b3%e5%9d%90%e6%a0%87" class="header-mark"></a>【第一步】导入aop相关坐标</h5><p>jdk8</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--spring核心依赖，会将spring-aop传递进来--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>5.2.10.RELEASE<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--切入点表达式依赖，目的是找到切入点方法，也就是找到要增强的方法--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>aspectjweaver<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>1.9.4<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>jdk17</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Spring Framework --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>5.3.10<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- AspectJ Weaver --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>aspectjweaver<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>1.9.7<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730150138448.png" title="image-20210730150138448" data-thumbnail="D:\AlphaGuoBlog\quark01\assets\image-20210730150138448.png">
        <img
            
            loading="lazy"
            src="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730150138448.png"
            srcset="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730150138448.png, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730150138448.png 1.5x, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730150138448.png 2x"
            sizes="auto"
            alt="image-20210730150138448">
    </a></figure></p>
<h5 id="第二步定义dao接口与实现类" class="headerLink">
    <a href="#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e5%ae%9a%e4%b9%89dao%e6%8e%a5%e5%8f%a3%e4%b8%8e%e5%ae%9e%e7%8e%b0%e7%b1%bb" class="header-mark"></a>【第二步】定义dao接口与实现类</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">BookDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Repository</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookDaoImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BookDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;book dao save ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;book dao update ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="第三步定义通知类制作通知方法" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%89%e6%ad%a5%e5%ae%9a%e4%b9%89%e9%80%9a%e7%9f%a5%e7%b1%bb%e5%88%b6%e4%bd%9c%e9%80%9a%e7%9f%a5%e6%96%b9%e6%b3%95" class="header-mark"></a>【第三步】定义通知类，制作通知方法</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//通知类必须配置成Spring管理的bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyAdvice</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">method</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="第四步定义切入点表达式配置切面绑定切入点与通知关系" class="headerLink">
    <a href="#%e7%ac%ac%e5%9b%9b%e6%ad%a5%e5%ae%9a%e4%b9%89%e5%88%87%e5%85%a5%e7%82%b9%e8%a1%a8%e8%be%be%e5%bc%8f%e9%85%8d%e7%bd%ae%e5%88%87%e9%9d%a2%e7%bb%91%e5%ae%9a%e5%88%87%e5%85%a5%e7%82%b9%e4%b8%8e%e9%80%9a%e7%9f%a5%e5%85%b3%e7%b3%bb" class="header-mark"></a>【第四步】定义切入点表达式、配置切面(绑定切入点与通知关系)</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//通知类必须配置成Spring管理的bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//设置当前类为切面类类</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Aspect</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyAdvice</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//设置切入点，@Pointcut注解要求配置在方法上方</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Pointcut</span><span class="p">(</span><span class="s">&#34;execution(void com.itheima.dao.BookDao.update())&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">pt</span><span class="p">(){}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//设置在切入点pt()的前面运行当前操作(前置通知)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Before</span><span class="p">(</span><span class="s">&#34;pt()&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">method</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="第五步在配置类中进行spring注解包扫描和开启aop功能" class="headerLink">
    <a href="#%e7%ac%ac%e4%ba%94%e6%ad%a5%e5%9c%a8%e9%85%8d%e7%bd%ae%e7%b1%bb%e4%b8%ad%e8%bf%9b%e8%a1%8cspring%e6%b3%a8%e8%a7%a3%e5%8c%85%e6%89%ab%e6%8f%8f%e5%92%8c%e5%bc%80%e5%90%afaop%e5%8a%9f%e8%83%bd" class="header-mark"></a>【第五步】在配置类中进行Spring注解包扫描和开启AOP功能</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@ComponentScan</span><span class="p">(</span><span class="s">&#34;com.itheima&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//开启注解开发AOP功能</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@EnableAspectJAutoProxy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="测试类和运行结果" class="headerLink">
    <a href="#%e6%b5%8b%e8%af%95%e7%b1%bb%e5%92%8c%e8%bf%90%e8%a1%8c%e7%bb%93%e6%9e%9c" class="header-mark"></a>测试类和运行结果</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">App</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">SpringConfig</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">BookDao</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">bookDao</span><span class="p">.</span><span class="na">update</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730151347354.png" title="image-20210730151347354" data-thumbnail="D:\AlphaGuoBlog\quark01\assets\image-20210730151347354.png">
        <img
            
            loading="lazy"
            src="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730151347354.png"
            srcset="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730151347354.png, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730151347354.png 1.5x, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730151347354.png 2x"
            sizes="auto"
            alt="image-20210730151347354">
    </a></figure></p>
<h3 id="3-aop工作流程理解" class="headerLink">
    <a href="#3-aop%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b%e7%90%86%e8%a7%a3" class="header-mark"></a>3 AOP工作流程【理解】</h3><h4 id="问题导入-23" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-23" class="header-mark"></a>问题导入</h4><p>什么是目标对象？什么是代理对象？</p>
<h4 id="31-aop工作流程" class="headerLink">
    <a href="#31-aop%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b" class="header-mark"></a>3.1 AOP工作流程</h4><ol>
<li>Spring容器启动</li>
<li>读取所有切面配置中的切入点</li>
<li>初始化bean，判定bean对应的类中的方法是否匹配到任意切入点
<ul>
<li>匹配失败，创建原始对象</li>
<li>匹配成功，创建原始对象（目标对象）的代理对象</li>
</ul>
</li>
<li>获取bean执行方法
<ul>
<li>获取的bean是原始对象时，调用方法并执行，完成操作</li>
<li>获取的bean是代理对象时，根据代理对象的运行模式运行原始方法与增强的内容，完成操作</li>
</ul>
</li>
</ol>
<h4 id="32-aop核心概念" class="headerLink">
    <a href="#32-aop%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5" class="header-mark"></a>3.2 AOP核心概念</h4><p>目标对象（Target）：被代理的对象，也叫原始对象，该对象中的方法没有任何功能增强。
代理对象（Proxy）：代理后生成的对象，由Spring帮我们创建代理对象。</p>
<h4 id="33-在测试类中验证代理对象" class="headerLink">
    <a href="#33-%e5%9c%a8%e6%b5%8b%e8%af%95%e7%b1%bb%e4%b8%ad%e9%aa%8c%e8%af%81%e4%bb%a3%e7%90%86%e5%af%b9%e8%b1%a1" class="header-mark"></a>3.3 在测试类中验证代理对象</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">App</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">SpringConfig</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">BookDao</span><span class="w"> </span><span class="n">bookDao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">BookDao</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">bookDao</span><span class="p">.</span><span class="na">update</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="c1">//打印对象的类名</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">bookDao</span><span class="p">.</span><span class="na">getClass</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730152631741.png" title="image-20210730152631741" data-thumbnail="D:\AlphaGuoBlog\quark01\assets\image-20210730152631741.png">
        <img
            
            loading="lazy"
            src="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730152631741.png"
            srcset="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730152631741.png, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730152631741.png 1.5x, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730152631741.png 2x"
            sizes="auto"
            alt="image-20210730152631741">
    </a></figure></p>
<h3 id="4-aop切入点表达式" class="headerLink">
    <a href="#4-aop%e5%88%87%e5%85%a5%e7%82%b9%e8%a1%a8%e8%be%be%e5%bc%8f" class="header-mark"></a>4 AOP切入点表达式</h3><h4 id="问题导入-24" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-24" class="header-mark"></a>问题导入</h4><p>在切入点表达式中如何简化包名和参数类型书写？</p>
<h4 id="41-语法格式" class="headerLink">
    <a href="#41-%e8%af%ad%e6%b3%95%e6%a0%bc%e5%bc%8f" class="header-mark"></a>4.1 语法格式</h4><ul>
<li>
<p>切入点：要进行增强的方法</p>
</li>
<li>
<p>切入点表达式：要进行增强的方法的描述方式</p>
<ul>
<li>描述方式一：执行com.itheima.dao包下的BookDao接口中的无参数update方法</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">execution</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">itheima</span><span class="p">.</span><span class="na">dao</span><span class="p">.</span><span class="na">BookDao</span><span class="p">.</span><span class="na">update</span><span class="p">())</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>描述方式二：执行com.itheima.dao.impl包下的BookDaoImpl类中的无参数update方法</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">execution</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">itheima</span><span class="p">.</span><span class="na">dao</span><span class="p">.</span><span class="na">impl</span><span class="p">.</span><span class="na">BookDaoImpl</span><span class="p">.</span><span class="na">update</span><span class="p">())</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>切入点表达式标准格式：动作关键字(访问修饰符  返回值  包名.类/接口名.方法名(参数) 异常名）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">execution(public User com.itheima.service.UserService.findById(int))
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>动作关键字：描述切入点的行为动作，例如execution表示执行到指定切入点</li>
<li>访问修饰符：public，private等，可以省略</li>
<li>返回值：写返回值类型</li>
<li>包名：多级包使用点连接</li>
<li>类/接口名：</li>
<li>方法名：</li>
<li>参数：直接写参数的类型，多个类型用逗号隔开</li>
<li>异常名：方法定义中抛出指定异常，可以省略</li>
</ul>
</li>
</ul>
<h4 id="42-通配符" class="headerLink">
    <a href="#42-%e9%80%9a%e9%85%8d%e7%ac%a6" class="header-mark"></a>4.2 通配符</h4><blockquote>
<p>目的：可以使用通配符描述切入点，快速描述。</p>
</blockquote>
<ul>
<li>：单个独立的任意符号，可以独立出现，也可以作为前缀或者后缀的匹配符出现</li>
</ul>
<blockquote>
<p>匹配com.itheima包下的任意包中的UserService类或接口中所有find开头的带有一个参数的方法</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">execution</span><span class="err">（</span><span class="kd">public</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">itheima</span><span class="p">.</span><span class="o">*</span><span class="p">.</span><span class="na">UserService</span><span class="p">.</span><span class="na">find</span><span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="p">))</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>.. ：多个连续的任意符号，可以独立出现，常用于简化包名与参数的书写</li>
</ul>
<blockquote>
<p>匹配com包下的任意包中的UserService类或接口中所有名称为findById的方法</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">execution</span><span class="err">（</span><span class="kd">public</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">com</span><span class="p">..</span><span class="na">UserService</span><span class="p">.</span><span class="na">findById</span><span class="p">(..))</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>+：专用于匹配子类类型</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">execution</span><span class="p">(</span><span class="o">*</span><span class="w"> </span><span class="o">*</span><span class="p">..</span><span class="o">*</span><span class="n">Service</span><span class="o">+</span><span class="p">.</span><span class="o">*</span><span class="p">(..))</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730153824117.png" title="image-20210730153824117" data-thumbnail="D:\AlphaGuoBlog\quark01\assets\image-20210730153824117.png">
        <img
            
            loading="lazy"
            src="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730153824117.png"
            srcset="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730153824117.png, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730153824117.png 1.5x, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730153824117.png 2x"
            sizes="auto"
            alt="image-20210730153824117">
    </a></figure></p>
<h4 id="43-书写技巧" class="headerLink">
    <a href="#43-%e4%b9%a6%e5%86%99%e6%8a%80%e5%b7%a7" class="header-mark"></a>4.3 书写技巧</h4><ul>
<li>所有代码按照标准规范开发，否则以下技巧全部失效</li>
<li>描述切入点通**==常描述接口==**，而不描述实现类</li>
<li>访问控制修饰符针对接口开发均采用public描述（<strong>==可省略访问控制修饰符描述==</strong>）</li>
<li>返回值类型对于增删改类使用精准类型加速匹配，对于查询类使用*通配快速描述</li>
<li><strong>==包名==<strong>书写</strong>==尽量不使用..匹配==</strong>，效率过低，常用*做单个包描述匹配，或精准匹配</li>
<li><strong>==接口名/类名==<strong>书写名称与模块相关的</strong>==采用*匹配==</strong>，例如UserService书写成*Service，绑定业务层接口名</li>
<li><strong>==方法名==<strong>书写以</strong>==动词==<strong>进行</strong>==精准匹配==</strong>，名词采用<em>匹配，例如getById书写成getBy</em>,selectAll书写成selectAll</li>
<li>参数规则较为复杂，根据业务方法灵活调整</li>
<li>通常**==不使用异常==<strong>作为</strong>==匹配==**规则</li>
</ul>
<h3 id="5-aop通知类型重点" class="headerLink">
    <a href="#5-aop%e9%80%9a%e7%9f%a5%e7%b1%bb%e5%9e%8b%e9%87%8d%e7%82%b9" class="header-mark"></a>5 AOP通知类型【重点】</h3><h4 id="问题导入-25" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-25" class="header-mark"></a>问题导入</h4><p>请描述一下如何定义环绕通知方法？</p>
<h4 id="51-aop通知分类" class="headerLink">
    <a href="#51-aop%e9%80%9a%e7%9f%a5%e5%88%86%e7%b1%bb" class="header-mark"></a>5.1 AOP通知分类</h4><ul>
<li>AOP通知描述了抽取的共性功能，根据共性功能抽取的位置不同，最终运行代码时要将其加入到合理的位置</li>
<li>AOP通知共分为5种类型
<ul>
<li>前置通知：在切入点方法执行之前执行</li>
<li>后置通知：在切入点方法执行之后执行，无论切入点方法内部是否出现异常，后置通知都会执行。</li>
<li>**==环绕通知(重点)：==**手动调用切入点方法并对其进行增强的通知方式。</li>
<li>返回后通知(了解)：在切入点方法执行之后执行，如果切入点方法内部出现异常将不会执行。</li>
<li>抛出异常后通知(了解)：在切入点方法执行之后执行，只有当切入点方法内部出现异常之后才执行。</li>
</ul>
</li>
</ul>
<h4 id="52-aop通知详解" class="headerLink">
    <a href="#52-aop%e9%80%9a%e7%9f%a5%e8%af%a6%e8%a7%a3" class="header-mark"></a>5.2 AOP通知详解</h4><h5 id="521-前置通知" class="headerLink">
    <a href="#521-%e5%89%8d%e7%bd%ae%e9%80%9a%e7%9f%a5" class="header-mark"></a>5.2.1 前置通知</h5><ul>
<li>名称：@Before</li>
<li>类型：<strong>==方法注解==</strong></li>
<li>位置：通知方法定义上方</li>
<li>作用：设置当前通知方法与切入点之间的绑定关系，当前通知方法在原始切入点方法前运行</li>
<li>范例：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Before</span><span class="p">(</span><span class="s">&#34;pt()&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">before</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;before advice ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="522-后置通知" class="headerLink">
    <a href="#522-%e5%90%8e%e7%bd%ae%e9%80%9a%e7%9f%a5" class="header-mark"></a>5.2.2 后置通知</h5><ul>
<li>名称：@After</li>
<li>类型：==<strong>方法注解</strong>==</li>
<li>位置：通知方法定义上方</li>
<li>作用：设置当前通知方法与切入点之间的绑定关系，当前通知方法在原始切入点方法后运行</li>
<li>范例：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@After</span><span class="p">(</span><span class="s">&#34;pt()&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">after</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;after advice ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="523-返回后通知" class="headerLink">
    <a href="#523-%e8%bf%94%e5%9b%9e%e5%90%8e%e9%80%9a%e7%9f%a5" class="header-mark"></a>5.2.3 返回后通知</h5><ul>
<li>名称：@AfterReturning（了解）</li>
<li>类型：<strong>==方法注解==</strong></li>
<li>位置：通知方法定义上方</li>
<li>作用：设置当前通知方法与切入点之间的绑定关系，当前通知方法在原始切入点方法正常执行完毕后运行</li>
<li>范例：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@AfterReturning</span><span class="p">(</span><span class="s">&#34;pt()&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">afterReturning</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;afterReturning advice ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="524-抛出异常后通知" class="headerLink">
    <a href="#524-%e6%8a%9b%e5%87%ba%e5%bc%82%e5%b8%b8%e5%90%8e%e9%80%9a%e7%9f%a5" class="header-mark"></a>5.2.4 抛出异常后通知</h5><ul>
<li>名称：@AfterThrowing（了解）</li>
<li>类型：<strong>==方法注解==</strong></li>
<li>位置：通知方法定义上方</li>
<li>作用：设置当前通知方法与切入点之间的绑定关系，当前通知方法在原始切入点方法运行抛出异常后执行</li>
<li>范例：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@AfterThrowing</span><span class="p">(</span><span class="s">&#34;pt()&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">afterThrowing</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;afterThrowing advice ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="525-环绕通知" class="headerLink">
    <a href="#525-%e7%8e%af%e7%bb%95%e9%80%9a%e7%9f%a5" class="header-mark"></a>5.2.5 环绕通知</h5><ul>
<li>名称：@Around（重点，常用）</li>
<li>类型：<strong>==方法注解==</strong></li>
<li>位置：通知方法定义上方</li>
<li>作用：设置当前通知方法与切入点之间的绑定关系，当前通知方法在原始切入点方法前后运行</li>
<li>范例：：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Around</span><span class="p">(</span><span class="s">&#34;pt()&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">around</span><span class="p">(</span><span class="n">ProceedingJoinPoint</span><span class="w"> </span><span class="n">pjp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;around before advice ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Object</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pjp</span><span class="p">.</span><span class="na">proceed</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;around after advice ...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>==<strong>环绕通知注意事项</strong>==</p>
<ol>
<li>环绕通知方法形参必须是ProceedingJoinPoint，表示正在执行的连接点，使用该对象的proceed()方法表示对原始对象方法进行调用，返回值为原始对象方法的返回值。</li>
<li>环绕通知方法的返回值建议写成Object类型，用于将原始对象方法的返回值进行返回，哪里使用代理对象就返回到哪里。</li>
</ol>
<h2 id="九aop案例" class="headerLink">
    <a href="#%e4%b9%9daop%e6%a1%88%e4%be%8b" class="header-mark"></a>九、AOP案例</h2><h3 id="1-案例-测量业务层接口万次执行效率" class="headerLink">
    <a href="#1-%e6%a1%88%e4%be%8b-%e6%b5%8b%e9%87%8f%e4%b8%9a%e5%8a%a1%e5%b1%82%e6%8e%a5%e5%8f%a3%e4%b8%87%e6%ac%a1%e6%89%a7%e8%a1%8c%e6%95%88%e7%8e%87" class="header-mark"></a>1 案例-测量业务层接口万次执行效率</h3><h4 id="问题导入-26" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-26" class="header-mark"></a>问题导入</h4><p>能不能描述一下环绕通知里面的实现步骤？</p>
<h4 id="11-需求和分析" class="headerLink">
    <a href="#11-%e9%9c%80%e6%b1%82%e5%92%8c%e5%88%86%e6%9e%90" class="header-mark"></a>1.1 需求和分析</h4><p>需求：任意业务层接口执行均可显示其执行效率（执行时长）</p>
<p>分析：</p>
<p>​	①：业务功能：业务层接口执行前后分别记录时间，求差值得到执行效率
​	②：通知类型选择前后均可以增强的类型——环绕通知</p>
<h4 id="12-代码实现-1" class="headerLink">
    <a href="#12-%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0-1" class="header-mark"></a>1.2 代码实现</h4><h5 id="前置工作环境准备" class="headerLink">
    <a href="#%e5%89%8d%e7%bd%ae%e5%b7%a5%e4%bd%9c%e7%8e%af%e5%a2%83%e5%87%86%e5%a4%87" class="header-mark"></a>【前置工作】环境准备</h5><ol>
<li>
<p>Spring整合mybatis对spring_db数据库中的Account进行CRUD操作</p>
</li>
<li>
<p>Spring整合Junit测试CRUD是否OK。</p>
</li>
<li>
<p>在pom.xml中添加aspectjweaver切入点表达式依赖</p>
</li>
<li>
<p>&hellip; &hellip;</p>
</li>
</ol>
<h5 id="第一步编写通知类" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%80%e6%ad%a5%e7%bc%96%e5%86%99%e9%80%9a%e7%9f%a5%e7%b1%bb" class="header-mark"></a>【第一步】编写通知类</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Aspect</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ProjectAdvice</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//匹配业务层的所有方法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Pointcut</span><span class="p">(</span><span class="s">&#34;execution(* com.itheima.service.*Service.*(..))&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">servicePt</span><span class="p">(){}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//设置环绕通知，在原始操作的运行前后记录执行时间</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Around</span><span class="p">(</span><span class="s">&#34;ProjectAdvice.servicePt()&#34;</span><span class="p">)</span><span class="w"> </span><span class="c1">//本类类名可以省略不写</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">runSpeed</span><span class="p">(</span><span class="n">ProceedingJoinPoint</span><span class="w"> </span><span class="n">pjp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//获取执行的签名对象</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Signature</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pjp</span><span class="p">.</span><span class="na">getSignature</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//获取接口/类全限定名</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">className</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">signature</span><span class="p">.</span><span class="na">getDeclaringTypeName</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//获取方法名</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">methodName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">signature</span><span class="p">.</span><span class="na">getName</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//记录开始时间</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//执行万次操作</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">10000</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="n">pjp</span><span class="p">.</span><span class="na">proceed</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//记录结束时间</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//打印执行结果</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;万次执行：&#34;</span><span class="o">+</span><span class="w"> </span><span class="n">className</span><span class="o">+</span><span class="s">&#34;.&#34;</span><span class="o">+</span><span class="n">methodName</span><span class="o">+</span><span class="s">&#34;----&gt;&#34;</span><span class="w"> </span><span class="o">+</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;ms&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="第二步在springconfig配置类上开启aop注解功能" class="headerLink">
    <a href="#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e5%9c%a8springconfig%e9%85%8d%e7%bd%ae%e7%b1%bb%e4%b8%8a%e5%bc%80%e5%90%afaop%e6%b3%a8%e8%a7%a3%e5%8a%9f%e8%83%bd" class="header-mark"></a>【第二步】在SpringConfig配置类上开启AOP注解功能</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@ComponentScan</span><span class="p">(</span><span class="s">&#34;com.itheima&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@PropertySource</span><span class="p">(</span><span class="s">&#34;classpath:jdbc.properties&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Import</span><span class="p">({</span><span class="n">JdbcConfig</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="n">MybatisConfig</span><span class="p">.</span><span class="na">class</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@EnableAspectJAutoProxy</span><span class="w"> </span><span class="c1">//开启AOP注解功能</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="第三步运行测试类查看结果" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%89%e6%ad%a5%e8%bf%90%e8%a1%8c%e6%b5%8b%e8%af%95%e7%b1%bb%e6%9f%a5%e7%9c%8b%e7%bb%93%e6%9e%9c" class="header-mark"></a>【第三步】运行测试类，查看结果</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@ContextConfiguration</span><span class="p">(</span><span class="n">classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpringConfig</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AccountServiceTestCase</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AccountService</span><span class="w"> </span><span class="n">accountService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testFindById</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Account</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accountService</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">2</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testFindAll</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accountService</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730164219555.png" title="image-20210730164219555" data-thumbnail="D:\AlphaGuoBlog\quark01\assets\image-20210730164219555.png">
        <img
            
            loading="lazy"
            src="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730164219555.png"
            srcset="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730164219555.png, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730164219555.png 1.5x, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210730164219555.png 2x"
            sizes="auto"
            alt="image-20210730164219555">
    </a></figure></p>
<h3 id="2-aop切入点数据获取" class="headerLink">
    <a href="#2-aop%e5%88%87%e5%85%a5%e7%82%b9%e6%95%b0%e6%8d%ae%e8%8e%b7%e5%8f%96" class="header-mark"></a>2 AOP切入点数据获取</h3><h4 id="问题导入-27" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-27" class="header-mark"></a>问题导入</h4><p>在环绕通知中可以获取到哪些数据？</p>
<h4 id="21-获取参数" class="headerLink">
    <a href="#21-%e8%8e%b7%e5%8f%96%e5%8f%82%e6%95%b0" class="header-mark"></a>2.1 获取参数</h4><blockquote>
<p>说明：在前置通知和环绕通知中都可以获取到连接点方法的参数们</p>
</blockquote>
<ul>
<li>JoinPoint对象描述了连接点方法的运行状态，可以获取到原始方法的调用参数</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Before</span><span class="p">(</span><span class="s">&#34;pt()&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">before</span><span class="p">(</span><span class="n">JoinPoint</span><span class="w"> </span><span class="n">jp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jp</span><span class="p">.</span><span class="na">getArgs</span><span class="p">();</span><span class="w"> </span><span class="c1">//获取连接点方法的参数们</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">args</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ProccedJointPoint是JoinPoint的子类</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Around</span><span class="p">(</span><span class="s">&#34;pt()&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">around</span><span class="p">(</span><span class="n">ProceedingJoinPoint</span><span class="w"> </span><span class="n">pjp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pjp</span><span class="p">.</span><span class="na">getArgs</span><span class="p">();</span><span class="w"> </span><span class="c1">//获取连接点方法的参数们</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">args</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Object</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pjp</span><span class="p">.</span><span class="na">proceed</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="22-获取返回值" class="headerLink">
    <a href="#22-%e8%8e%b7%e5%8f%96%e8%bf%94%e5%9b%9e%e5%80%bc" class="header-mark"></a>2.2 获取返回值</h4><blockquote>
<p>说明：在返回后通知和环绕通知中都可以获取到连接点方法的返回值</p>
</blockquote>
<ul>
<li>抛出异常后通知可以获取切入点方法中出现的异常信息，使用形参可以接收对应的异常对象</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@AfterReturning</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;pt()&#34;</span><span class="p">,</span><span class="n">returning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;ret&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">afterReturning</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">ret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">//变量名要和returning=&#34;ret&#34;的属性值一致</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;afterReturning advice ...&#34;</span><span class="o">+</span><span class="n">ret</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>环绕通知中可以手工书写对原始方法的调用，得到的结果即为原始方法的返回值</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Around</span><span class="p">(</span><span class="s">&#34;pt()&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">around</span><span class="p">(</span><span class="n">ProceedingJoinPoint</span><span class="w"> </span><span class="n">pjp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 手动调用连接点方法，返回值就是连接点方法的返回值</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Object</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pjp</span><span class="p">.</span><span class="na">proceed</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="23-获取异常" class="headerLink">
    <a href="#23-%e8%8e%b7%e5%8f%96%e5%bc%82%e5%b8%b8" class="header-mark"></a>2.3 获取异常</h4><blockquote>
<p>说明：在抛出异常后通知和环绕通知中都可以获取到连接点方法中出现的异常</p>
</blockquote>
<ul>
<li>抛出异常后通知可以获取切入点方法中出现的异常信息，使用形参可以接收对应的异常对象</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@AfterThrowing</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;pt()&#34;</span><span class="p">,</span><span class="n">throwing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;t&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">afterThrowing</span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="c1">//变量名要和throwing = &#34;t&#34;的属性值一致</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;afterThrowing advice ...&#34;</span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>抛出异常后通知可以获取切入点方法运行的异常信息，使用形参可以接收运行时抛出的异常对象</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Around</span><span class="p">(</span><span class="s">&#34;pt()&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">around</span><span class="p">(</span><span class="n">ProceedingJoinPoint</span><span class="w"> </span><span class="n">pjp</span><span class="p">)</span><span class="w">  </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Object</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//此处需要try...catch处理，catch中捕获到的异常就是连接点方法中抛出的异常</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pjp</span><span class="p">.</span><span class="na">proceed</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">t</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-案例-百度网盘密码数据兼容处理" class="headerLink">
    <a href="#3-%e6%a1%88%e4%be%8b-%e7%99%be%e5%ba%a6%e7%bd%91%e7%9b%98%e5%af%86%e7%a0%81%e6%95%b0%e6%8d%ae%e5%85%bc%e5%ae%b9%e5%a4%84%e7%90%86" class="header-mark"></a>3 案例-百度网盘密码数据兼容处理</h3><h4 id="问题导入-28" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-28" class="header-mark"></a>问题导入</h4><p>请说出我们该使用什么类型的通知来完成这个需求？</p>
<h4 id="31-需求和分析" class="headerLink">
    <a href="#31-%e9%9c%80%e6%b1%82%e5%92%8c%e5%88%86%e6%9e%90" class="header-mark"></a>3.1 需求和分析</h4><p>需求：对百度网盘分享链接输入密码时尾部多输入的空格做兼容处理</p>
<p><figure><a class="lightgallery" href="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210731193059709.png" title="image-20210731193059709" data-thumbnail="D:\AlphaGuoBlog\quark01\assets\image-20210731193059709.png">
        <img
            
            loading="lazy"
            src="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210731193059709.png"
            srcset="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210731193059709.png, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210731193059709.png 1.5x, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210731193059709.png 2x"
            sizes="auto"
            alt="image-20210731193059709">
    </a></figure></p>
<p>分析：
①：在业务方法执行之前对所有的输入参数进行格式处理——trim()
②：使用处理后的参数调用原始方法——环绕通知中存在对原始方法的调用</p>
<h4 id="32-代码实现" class="headerLink">
    <a href="#32-%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0" class="header-mark"></a>3.2 代码实现</h4><h5 id="前置工作环境准备-1" class="headerLink">
    <a href="#%e5%89%8d%e7%bd%ae%e5%b7%a5%e4%bd%9c%e7%8e%af%e5%a2%83%e5%87%86%e5%a4%87-1" class="header-mark"></a>【前置工作】环境准备</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//-------------service层代码-----------------------</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ResourcesService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">openURL</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="p">,</span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ResourcesServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ResourcesService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ResourcesDao</span><span class="w"> </span><span class="n">resourcesDao</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">openURL</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">resourcesDao</span><span class="p">.</span><span class="na">readResources</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">password</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//-------------dao层代码-----------------------</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ResourcesDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">readResources</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Repository</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ResourcesDaoImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ResourcesDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">readResources</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">password</span><span class="p">.</span><span class="na">length</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//模拟校验</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">password</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&#34;root&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="第一步编写通知类-1" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%80%e6%ad%a5%e7%bc%96%e5%86%99%e9%80%9a%e7%9f%a5%e7%b1%bb-1" class="header-mark"></a>【第一步】编写通知类</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Aspect</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DataAdvice</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Pointcut</span><span class="p">(</span><span class="s">&#34;execution(boolean com.itheima.service.*Service.*(*,*))&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">servicePt</span><span class="p">(){}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Around</span><span class="p">(</span><span class="s">&#34;DataAdvice.servicePt()&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">trimStr</span><span class="p">(</span><span class="n">ProceedingJoinPoint</span><span class="w"> </span><span class="n">pjp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pjp</span><span class="p">.</span><span class="na">getArgs</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">//判断参数是不是字符串</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">)){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">args</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">toString</span><span class="p">().</span><span class="na">trim</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pjp</span><span class="p">.</span><span class="na">proceed</span><span class="p">(</span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="第二步在springconfig配置类上开启aop注解功能-1" class="headerLink">
    <a href="#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e5%9c%a8springconfig%e9%85%8d%e7%bd%ae%e7%b1%bb%e4%b8%8a%e5%bc%80%e5%90%afaop%e6%b3%a8%e8%a7%a3%e5%8a%9f%e8%83%bd-1" class="header-mark"></a>【第二步】在SpringConfig配置类上开启AOP注解功能</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@ComponentScan</span><span class="p">(</span><span class="s">&#34;com.itheima&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@EnableAspectJAutoProxy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="第三步运行测试类查看结果-1" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%89%e6%ad%a5%e8%bf%90%e8%a1%8c%e6%b5%8b%e8%af%95%e7%b1%bb%e6%9f%a5%e7%9c%8b%e7%bb%93%e6%9e%9c-1" class="header-mark"></a>【第三步】运行测试类，查看结果</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">App</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">SpringConfig</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ResourcesService</span><span class="w"> </span><span class="n">resourcesService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">ResourcesService</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">boolean</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resourcesService</span><span class="p">.</span><span class="na">openURL</span><span class="p">(</span><span class="s">&#34;http://pan.baidu.com/haha&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;root &#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">flag</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-aop开发总结" class="headerLink">
    <a href="#4-aop%e5%bc%80%e5%8f%91%e6%80%bb%e7%bb%93" class="header-mark"></a>4 AOP开发总结</h3><h4 id="41-aop的核心概念" class="headerLink">
    <a href="#41-aop%e7%9a%84%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5" class="header-mark"></a>4.1 AOP的核心概念</h4><ul>
<li>概念：AOP(Aspect Oriented Programming)面向切面编程，一种编程范式</li>
<li>作用：在不惊动原始设计的基础上为方法进行功能增强</li>
<li>核心概念
<ul>
<li>代理（Proxy）：SpringAOP的核心本质是采用代理模式实现的</li>
<li>连接点（JoinPoint）：	在SpringAOP中，理解为任意方法的执行</li>
<li>切入点（Pointcut）：匹配连接点的式子，也是具有共性功能的方法描述</li>
<li>通知（Advice）：若干个方法的共性功能，在切入点处执行，最终体现为一个方法</li>
<li>切面（Aspect）：描述通知与切入点的对应关系</li>
<li>目标对象（Target）：被代理的原始对象成为目标对象</li>
</ul>
</li>
</ul>
<h4 id="42-切入点表达式语法" class="headerLink">
    <a href="#42-%e5%88%87%e5%85%a5%e7%82%b9%e8%a1%a8%e8%be%be%e5%bc%8f%e8%af%ad%e6%b3%95" class="header-mark"></a>4.2 切入点表达式语法</h4><ul>
<li>
<p>切入点表达式标准格式：动作关键字(访问修饰符  返回值  包名.类/接口名.方法名（参数）异常名)</p>
<ul>
<li>execution(* com.itheima.service.<em>Service.</em>(..))</li>
</ul>
</li>
<li>
<p>切入点表达式描述通配符：</p>
<ul>
<li>作用：用于快速描述，范围描述</li>
<li>*：匹配任意符号（常用）</li>
<li>.. ：匹配多个连续的任意符号（常用）</li>
<li>+：匹配子类类型</li>
</ul>
</li>
<li>
<p>切入点表达式书写技巧</p>
<p>1.按标准规范开发
2.查询操作的返回值建议使用*匹配
3.减少使用..的形式描述包
4.对接口进行描述，使用*表示模块名，例如UserService的匹配描述为*Service
5.方法名书写保留动词，例如get，使用*表示名词，例如getById匹配描述为getBy*
6.参数根据实际情况灵活调整</p>
</li>
</ul>
<h4 id="43-五种通知类型" class="headerLink">
    <a href="#43-%e4%ba%94%e7%a7%8d%e9%80%9a%e7%9f%a5%e7%b1%bb%e5%9e%8b" class="header-mark"></a>4.3 五种通知类型</h4><ul>
<li>前置通知</li>
<li>后置通知
<ul>
<li>环绕通知（重点）</li>
<li>环绕通知依赖形参ProceedingJoinPoint才能实现对原始方法的调用</li>
<li>环绕通知可以隔离原始方法的调用执行</li>
<li>环绕通知返回值设置为Object类型</li>
<li>环绕通知中可以对原始方法调用过程中出现的异常进行处理</li>
</ul>
</li>
<li>返回后通知</li>
<li>抛出异常后通知</li>
</ul>
<h2 id="十spring事务管理" class="headerLink">
    <a href="#%e5%8d%81spring%e4%ba%8b%e5%8a%a1%e7%ae%a1%e7%90%86" class="header-mark"></a>十、Spring事务管理</h2><h3 id="1-spring事务简介重点" class="headerLink">
    <a href="#1-spring%e4%ba%8b%e5%8a%a1%e7%ae%80%e4%bb%8b%e9%87%8d%e7%82%b9" class="header-mark"></a>1 Spring事务简介【重点】</h3><h4 id="问题导入-29" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-29" class="header-mark"></a>问题导入</h4><p>Spring提供的事务管理是数据层的事务还是业务层的事务?</p>
<h4 id="11-spring事务作用" class="headerLink">
    <a href="#11-spring%e4%ba%8b%e5%8a%a1%e4%bd%9c%e7%94%a8" class="header-mark"></a>1.1 Spring事务作用</h4><ul>
<li>事务作用：在数据层保障一系列的数据库操作同成功同失败</li>
<li>Spring事务作用：在数据层或**==业务层==**保障一系列的数据库操作同成功同失败</li>
</ul>
<p><figure><a class="lightgallery" href="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210801190820853.png" title="image-20210801190820853" data-thumbnail="D:\AlphaGuoBlog\quark01\assets\image-20210801190820853.png">
        <img
            
            loading="lazy"
            src="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210801190820853.png"
            srcset="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210801190820853.png, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210801190820853.png 1.5x, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210801190820853.png 2x"
            sizes="auto"
            alt="image-20210801190820853">
    </a></figure></p>
<h4 id="12-需求和分析" class="headerLink">
    <a href="#12-%e9%9c%80%e6%b1%82%e5%92%8c%e5%88%86%e6%9e%90" class="header-mark"></a>1.2 需求和分析</h4><ul>
<li>需求：实现任意两个账户间转账操作</li>
<li>需求微缩：A账户减钱，B账户加钱</li>
<li>分析：
①：数据层提供基础操作，指定账户减钱（outMoney），指定账户加钱（inMoney）
②：业务层提供转账操作（transfer），调用减钱与加钱的操作
③：提供2个账号和操作金额执行转账操作
④：基于Spring整合MyBatis环境搭建上述操作</li>
<li>结果分析：
①：程序正常执行时，账户金额A减B加，没有问题
②：程序出现异常后，转账失败，但是异常之前操作成功，异常之后操作失败，整体业务失败</li>
</ul>
<h4 id="13-代码实现" class="headerLink">
    <a href="#13-%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0" class="header-mark"></a>1.3 代码实现</h4><h5 id="前置工作环境准备-2" class="headerLink">
    <a href="#%e5%89%8d%e7%bd%ae%e5%b7%a5%e4%bd%9c%e7%8e%af%e5%a2%83%e5%87%86%e5%a4%87-2" class="header-mark"></a>【前置工作】环境准备</h5><blockquote>
<p>Spring整合Mybatis相关代码(依赖、JdbcConfig、MybatisConfig、SpringConfig)省略。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">AccountDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Update</span><span class="p">(</span><span class="s">&#34;update tbl_account set money = money + #{money} where name = #{name}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">inMoney</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&#34;money&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Double</span><span class="w"> </span><span class="n">money</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Update</span><span class="p">(</span><span class="s">&#34;update tbl_account set money = money - #{money} where name = #{name}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">outMoney</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&#34;money&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Double</span><span class="w"> </span><span class="n">money</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">AccountService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 转账操作
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param out 传出方
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param in 转入方
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param money 金额
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">transfer</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="n">String</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="p">,</span><span class="n">Double</span><span class="w"> </span><span class="n">money</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AccountServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">AccountService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AccountDao</span><span class="w"> </span><span class="n">accountDao</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">transfer</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="n">String</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="p">,</span><span class="n">Double</span><span class="w"> </span><span class="n">money</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">accountDao</span><span class="p">.</span><span class="na">outMoney</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">money</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">1</span><span class="o">/</span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">accountDao</span><span class="p">.</span><span class="na">inMoney</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="n">money</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="第一步在业务层接口上添加spring事务管理" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%80%e6%ad%a5%e5%9c%a8%e4%b8%9a%e5%8a%a1%e5%b1%82%e6%8e%a5%e5%8f%a3%e4%b8%8a%e6%b7%bb%e5%8a%a0spring%e4%ba%8b%e5%8a%a1%e7%ae%a1%e7%90%86" class="header-mark"></a>【第一步】在业务层接口上添加Spring事务管理</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">AccountService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//配置当前接口方法具有事务</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Transactional</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">transfer</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="n">String</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="p">,</span><span class="n">Double</span><span class="w"> </span><span class="n">money</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>注意事项</p>
<ol>
<li>Spring注解式事务通常添加在业务层接口中而不会添加到业务层实现类中，降低耦合</li>
<li>注解式事务可以添加到业务方法上表示当前方法开启事务，也可以添加到接口上表示当前接口所有方法开启事务</li>
</ol>
<h5 id="第二步设置事务管理器将事务管理器添加到ioc容器中" class="headerLink">
    <a href="#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e8%ae%be%e7%bd%ae%e4%ba%8b%e5%8a%a1%e7%ae%a1%e7%90%86%e5%99%a8%e5%b0%86%e4%ba%8b%e5%8a%a1%e7%ae%a1%e7%90%86%e5%99%a8%e6%b7%bb%e5%8a%a0%e5%88%b0ioc%e5%ae%b9%e5%99%a8%e4%b8%ad" class="header-mark"></a>【第二步】设置事务管理器(将事务管理器添加到IOC容器中)</h5><blockquote>
<p>说明：可以在JdbcConfig中配置事务管理器</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//配置事务管理器，mybatis使用的是jdbc事务</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">PlatformTransactionManager</span><span class="w"> </span><span class="nf">transactionManager</span><span class="p">(</span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DataSourceTransactionManager</span><span class="w"> </span><span class="n">dtm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DataSourceTransactionManager</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">transactionManager</span><span class="p">.</span><span class="na">setDataSource</span><span class="p">(</span><span class="n">dataSource</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">transactionManager</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>注意事项</p>
<ol>
<li>事务管理器要根据实现技术进行选择</li>
<li>MyBatis框架使用的是JDBC事务</li>
</ol>
<h5 id="第三步开启注解式事务驱动" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%89%e6%ad%a5%e5%bc%80%e5%90%af%e6%b3%a8%e8%a7%a3%e5%bc%8f%e4%ba%8b%e5%8a%a1%e9%a9%b1%e5%8a%a8" class="header-mark"></a>【第三步】开启注解式事务驱动</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@ComponentScan</span><span class="p">(</span><span class="s">&#34;com.itheima&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@PropertySource</span><span class="p">(</span><span class="s">&#34;classpath:jdbc.properties&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Import</span><span class="p">({</span><span class="n">JdbcConfig</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="n">MybatisConfig</span><span class="p">.</span><span class="na">class</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//开启注解式事务驱动</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@EnableTransactionManagement</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="第四步运行测试类查看结果" class="headerLink">
    <a href="#%e7%ac%ac%e5%9b%9b%e6%ad%a5%e8%bf%90%e8%a1%8c%e6%b5%8b%e8%af%95%e7%b1%bb%e6%9f%a5%e7%9c%8b%e7%bb%93%e6%9e%9c" class="header-mark"></a>【第四步】运行测试类，查看结果</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@ContextConfiguration</span><span class="p">(</span><span class="n">classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpringConfig</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AccountServiceTest</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AccountService</span><span class="w"> </span><span class="n">accountService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testTransfer</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">accountService</span><span class="p">.</span><span class="na">transfer</span><span class="p">(</span><span class="s">&#34;Tom&#34;</span><span class="p">,</span><span class="s">&#34;Jerry&#34;</span><span class="p">,</span><span class="n">100D</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-spring事务角色理解" class="headerLink">
    <a href="#2-spring%e4%ba%8b%e5%8a%a1%e8%a7%92%e8%89%b2%e7%90%86%e8%a7%a3" class="header-mark"></a>2 Spring事务角色【理解】</h3><h4 id="问题导入-30" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-30" class="header-mark"></a>问题导入</h4><p>什么是事务管理员，什么是事务协调员？</p>
<h4 id="21-spring事务角色" class="headerLink">
    <a href="#21-spring%e4%ba%8b%e5%8a%a1%e8%a7%92%e8%89%b2" class="header-mark"></a>2.1 Spring事务角色</h4><ul>
<li>事务管理员：发起事务方，在Spring中通常指代业务层开启事务的方法</li>
<li>事务协调员：加入事务方，在Spring中通常指代数据层方法，也可以是业务层方法</li>
</ul>
<p><figure><a class="lightgallery" href="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210801192453227.png" title="image-20210801192453227" data-thumbnail="D:\AlphaGuoBlog\quark01\assets\image-20210801192453227.png">
        <img
            
            loading="lazy"
            src="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210801192453227.png"
            srcset="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210801192453227.png, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210801192453227.png 1.5x, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210801192453227.png 2x"
            sizes="auto"
            alt="image-20210801192453227">
    </a></figure></p>
<h3 id="3-spring事务相关配置" class="headerLink">
    <a href="#3-spring%e4%ba%8b%e5%8a%a1%e7%9b%b8%e5%85%b3%e9%85%8d%e7%bd%ae" class="header-mark"></a>3 Spring事务相关配置</h3><h4 id="问题导入-31" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%af%bc%e5%85%a5-31" class="header-mark"></a>问题导入</h4><p>什么样的异常，Spring事务默认是不进行回滚的？</p>
<h4 id="31-事务配置" class="headerLink">
    <a href="#31-%e4%ba%8b%e5%8a%a1%e9%85%8d%e7%bd%ae" class="header-mark"></a>3.1 事务配置</h4><p><figure><a class="lightgallery" href="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210802151553053.png" title="image-20210802151553053" data-thumbnail="D:\AlphaGuoBlog\quark01\assets\image-20210802151553053.png">
        <img
            
            loading="lazy"
            src="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210802151553053.png"
            srcset="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210802151553053.png, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210802151553053.png 1.5x, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210802151553053.png 2x"
            sizes="auto"
            alt="image-20210802151553053">
    </a></figure></p>
<blockquote>
<p>说明：对于RuntimeException类型异常或者Error错误，Spring事务能够进行回滚操作。但是对于编译器异常，Spring事务是不进行回滚的，所以需要使用rollbackFor来设置要回滚的异常。</p>
</blockquote>
<h4 id="32-案例转账业务追加日志" class="headerLink">
    <a href="#32-%e6%a1%88%e4%be%8b%e8%bd%ac%e8%b4%a6%e4%b8%9a%e5%8a%a1%e8%bf%bd%e5%8a%a0%e6%97%a5%e5%bf%97" class="header-mark"></a>3.2 案例：转账业务追加日志</h4><h5 id="需求和分析" class="headerLink">
    <a href="#%e9%9c%80%e6%b1%82%e5%92%8c%e5%88%86%e6%9e%90" class="header-mark"></a>需求和分析</h5><ul>
<li>需求：实现任意两个账户间转账操作，并对每次转账操作在数据库进行留痕</li>
<li>需求微缩：A账户减钱，B账户加钱，数据库记录日志</li>
<li>分析：
①：基于转账操作案例添加日志模块，实现数据库中记录日志
②：业务层转账操作（transfer），调用减钱、加钱与记录日志功能</li>
<li>实现效果预期：
无论转账操作是否成功，均进行转账操作的日志留痕</li>
<li>存在的问题：
日志的记录与转账操作隶属同一个事务，同成功同失败</li>
<li>实现效果预期改进：
无论转账操作是否成功，日志必须保留</li>
<li>事务传播行为：事务协调员对事务管理员所携带事务的处理态度</li>
</ul>
<p><figure><a class="lightgallery" href="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210802153216460.png" title="image-20210802153216460" data-thumbnail="D:\AlphaGuoBlog\quark01\assets\image-20210802153216460.png">
        <img
            
            loading="lazy"
            src="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210802153216460.png"
            srcset="D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210802153216460.png, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210802153216460.png 1.5x, D:%5cAlphaGuoBlog%5cquark01%5cassets%5cimage-20210802153216460.png 2x"
            sizes="auto"
            alt="image-20210802153216460">
    </a></figure></p>
<h5 id="准备工作环境整备" class="headerLink">
    <a href="#%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c%e7%8e%af%e5%a2%83%e6%95%b4%e5%a4%87" class="header-mark"></a>【准备工作】环境整备</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">USE</span><span class="w"> </span><span class="n">spring_db</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">tbl_log</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">info</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">createDate</span><span class="w"> </span><span class="nb">DATE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">LogService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//propagation设置事务属性：传播行为设置为当前操作需要新事务</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Transactional</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">Double</span><span class="w"> </span><span class="n">money</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LogServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">LogService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LogDao</span><span class="w"> </span><span class="n">logDao</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="n">String</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="n">Double</span><span class="w"> </span><span class="n">money</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">logDao</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&#34;转账操作由&#34;</span><span class="o">+</span><span class="n">out</span><span class="o">+</span><span class="s">&#34;到&#34;</span><span class="o">+</span><span class="n">in</span><span class="o">+</span><span class="s">&#34;,金额：&#34;</span><span class="o">+</span><span class="n">money</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">LogDao</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Insert</span><span class="p">(</span><span class="s">&#34;insert into tbl_log (info,createDate) values(#{info},now())&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">info</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="第一步在accountserviceimpl中调用logservice中添加日志的方法" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%80%e6%ad%a5%e5%9c%a8accountserviceimpl%e4%b8%ad%e8%b0%83%e7%94%a8logservice%e4%b8%ad%e6%b7%bb%e5%8a%a0%e6%97%a5%e5%bf%97%e7%9a%84%e6%96%b9%e6%b3%95" class="header-mark"></a>【第一步】在AccountServiceImpl中调用logService中添加日志的方法</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AccountServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">AccountService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AccountDao</span><span class="w"> </span><span class="n">accountDao</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LogService</span><span class="w"> </span><span class="n">logService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">transfer</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="n">String</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="p">,</span><span class="n">Double</span><span class="w"> </span><span class="n">money</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">accountDao</span><span class="p">.</span><span class="na">outMoney</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">money</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">1</span><span class="o">/</span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">accountDao</span><span class="p">.</span><span class="na">inMoney</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="n">money</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">logService</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">in</span><span class="p">,</span><span class="n">money</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="第二步在logservice的log方法上设置事务的传播行为" class="headerLink">
    <a href="#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e5%9c%a8logservice%e7%9a%84log%e6%96%b9%e6%b3%95%e4%b8%8a%e8%ae%be%e7%bd%ae%e4%ba%8b%e5%8a%a1%e7%9a%84%e4%bc%a0%e6%92%ad%e8%a1%8c%e4%b8%ba" class="header-mark"></a>【第二步】在LogService的log()方法上设置事务的传播行为</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">LogService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//propagation设置事务属性：传播行为设置为当前操作需要新事务</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Transactional</span><span class="p">(</span><span class="n">propagation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Propagation</span><span class="p">.</span><span class="na">REQUIRES_NEW</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//设置事物回滚异常</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Transactional</span><span class="p">(</span><span class="n">rollbackFor</span><span class="o">=</span><span class="p">{</span><span class="n">IOException</span><span class="p">.</span><span class="na">class</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">Double</span><span class="w"> </span><span class="n">money</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="第三步运行测试类查看结果-2" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%89%e6%ad%a5%e8%bf%90%e8%a1%8c%e6%b5%8b%e8%af%95%e7%b1%bb%e6%9f%a5%e7%9c%8b%e7%bb%93%e6%9e%9c-2" class="header-mark"></a>【第三步】运行测试类，查看结果</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@ContextConfiguration</span><span class="p">(</span><span class="n">classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpringConfig</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AccountServiceTest</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AccountService</span><span class="w"> </span><span class="n">accountService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testTransfer</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">accountService</span><span class="p">.</span><span class="na">transfer</span><span class="p">(</span><span class="s">&#34;Tom&#34;</span><span class="p">,</span><span class="s">&#34;Jerry&#34;</span><span class="p">,</span><span class="n">50D</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="33-事务传播行为" class="headerLink">
    <a href="#33-%e4%ba%8b%e5%8a%a1%e4%bc%a0%e6%92%ad%e8%a1%8c%e4%b8%ba" class="header-mark"></a>3.3 事务传播行为</h4><p><figure><a class="lightgallery" href="D:%5c%e6%96%b0%e5%bb%ba%e6%96%87%e4%bb%b6%e5%a4%b9%5c_posts%5cassets%5cimage-20210802153014296.png" title="image-20210802153014296" data-thumbnail="D:\新建文件夹\_posts\assets\image-20210802153014296.png">
        <img
            
            loading="lazy"
            src="D:%5c%e6%96%b0%e5%bb%ba%e6%96%87%e4%bb%b6%e5%a4%b9%5c_posts%5cassets%5cimage-20210802153014296.png"
            srcset="D:%5c%e6%96%b0%e5%bb%ba%e6%96%87%e4%bb%b6%e5%a4%b9%5c_posts%5cassets%5cimage-20210802153014296.png, D:%5c%e6%96%b0%e5%bb%ba%e6%96%87%e4%bb%b6%e5%a4%b9%5c_posts%5cassets%5cimage-20210802153014296.png 1.5x, D:%5c%e6%96%b0%e5%bb%ba%e6%96%87%e4%bb%b6%e5%a4%b9%5c_posts%5cassets%5cimage-20210802153014296.png 2x"
            sizes="auto"
            alt="image-20210802153014296">
    </a></figure></p>
</div>

        

<div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2023-12-31</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span><a class="link-to-mardown" href=/spring01/index.md target="_blank" rel="noopener noreferrer">阅读原始文档</a>
                    </span></div>
            <div class="post-info-share"><button title="分享到 Twitter" data-sharer="twitter" data-url="https://ghd.icu/spring01/" data-title="Spring01" data-via="@guo_alpha36266" data-hashtags="Spring"><span class="fab fa-twitter fa-fw"></span></button><button title="分享到 Facebook" data-sharer="facebook" data-url="https://ghd.icu/spring01/" data-hashtag="Spring"><span class="fab fa-facebook-square fa-fw"></span></button><button title="分享到 WhatsApp" data-sharer="whatsapp" data-url="https://ghd.icu/spring01/" data-title="Spring01" data-web><span class="fab fa-whatsapp fa-fw"></span></button><button title="分享到 Line" data-sharer="line" data-url="https://ghd.icu/spring01/" data-title="Spring01"><span data-svg-src="/lib/simple-icons/icons/line.min.svg"></span></button><button title="分享到 微博" data-sharer="weibo" data-url="https://ghd.icu/spring01/" data-title="Spring01"><span class="fab fa-weibo fa-fw"></span></button><button title="分享到 Myspace" data-sharer="myspace" data-url="https://ghd.icu/spring01/" data-title="Spring01" data-description=""><span data-svg-src="/lib/simple-icons/icons/myspace.min.svg"></span></button><button title="分享到 Blogger" data-sharer="blogger" data-url="https://ghd.icu/spring01/" data-title="Spring01" data-description=""><span class="fab fa-blogger fa-fw"></span></button><button title="分享到 Evernote" data-sharer="evernote" data-url="https://ghd.icu/spring01/" data-title="Spring01"><span class="fab fa-evernote fa-fw"></span></button></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/spring/">Spring</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/mybatis%E7%9A%84%E5%A4%9A%E8%A1%A8%E6%A8%A1%E5%9E%8B/" class="prev" rel="prev" title="Mybatis的多表模型"><i class="fas fa-angle-left fa-fw"></i>Mybatis的多表模型</a>
            <a href="/%E6%8C%87%E9%92%88/" class="next" rel="next" title="指针">指针<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"></div></article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank" rel="noopener noreferrer">AlphaGuo</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="回到顶部">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div id="cookieconsent-container"></div><div class="assets"><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/katex/copy-tex.min.css">
        <noscript><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"></noscript><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"data":{"desktop-header-typeit":"AlphaGuo Blog","mobile-header-typeit":"AlphaGuo Blog"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"distance":100,"findAllMatches":false,"fuseIndexURL":"/index.json","highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":false,"isCaseSensitive":false,"location":0,"maxResultLength":10,"minMatchCharLength":2,"noResultsFound":"没有找到结果","snippetLength":50,"threshold":0.3,"type":"fuse","useExtendedSearch":false},"sharerjs":true,"table":{"sort":true},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},"duration":-1,"speed":250}};</script><script type="text/javascript" src="/lib/tablesort/tablesort.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/typeit.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js" defer></script><script type="text/javascript" src="/lib/katex/auto-render.min.js" defer></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js" defer></script><script type="text/javascript" src="/lib/katex/mhchem.min.js" defer></script><script type="text/javascript" src="/js/katex.min.js" defer></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script type="text/javascript" src="/js/cookieconsent.min.js" defer></script><script type="text/javascript" src="/js/theme.min.js" defer></script></div>
</body>

</html>
